import{a as y,e as D,r as h,f as M,h as c,o as r,b as _,i as s,j as l,w as n,F as m,k as v,u,l as E,v as C,m as Y,p as N,c as $,q as S,t as f,s as j,x as z,y as H,V as T,A as U,z as R,B as O}from"./entry.37edf189.js";import{C as G}from"./CategoryApi.3ef6f028.js";import{T as J}from"./TagApi.6f16efd8.js";const F=o=>(j("data-v-d3d83a7c"),o=o(),z(),o),K=F(()=>s("span",{class:"title"},"\u6587\u7AE0\u5206\u7C7B",-1)),P={class:"content"},Q=F(()=>s("span",{class:"title"},"\u6587\u7AE0\u6807\u7B7E",-1)),W={class:"content"},X={class:"custom-options"},Z=y({__name:"EditorRight",setup(o){const e=D(),a=h(!1),d=h([]),i=h([]);async function V(){d.value=await J.getTag()}async function g(){i.value=await G.getCategory()}return M(()=>{g(),V()}),(oe,p)=>{const b=c("el-option"),A=c("el-select"),k=N,I=c("el-input"),x=c("icon-arrow-left"),w=c("el-icon"),q=c("icon-arrow-right");return r(),_("div",{class:"right",style:Y({right:a.value?"-220px":"-20px"})},[s("section",null,[K,s("div",P,[l(k,null,{default:n(()=>[l(A,{key:"category",modelValue:u(e).article.category_id,"onUpdate:modelValue":p[0]||(p[0]=t=>u(e).article.category_id=t)},{default:n(()=>[(r(!0),_(m,null,v(i.value,t=>(r(),$(b,{key:t.mid,label:t.name,value:t.mid},{default:n(()=>[S(f(t.name),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])]),s("section",null,[Q,s("div",W,[l(k,null,{default:n(()=>[l(A,{key:"category",modelValue:u(e).article.selectedTag,"onUpdate:modelValue":p[1]||(p[1]=t=>u(e).article.selectedTag=t),filterable:"",multiple:""},{default:n(()=>[(r(!0),_(m,null,v(d.value,t=>(r(),$(b,{key:t.tid,label:t.name,value:t.tid},{default:n(()=>[S(f(t.name),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])]),s("div",X,[(r(!0),_(m,null,v(u(e).article.fields,(t,B)=>(r(),_(m,{key:t.name},[s("span",null,f(t.name),1),l(I,{modelValue:u(e).article.fields[B].value,"onUpdate:modelValue":L=>u(e).article.fields[B].value=L,type:"textarea",rows:"6",class:"input-with-select",placeholder:"\u8BF7\u8F93\u5165"},null,8,["modelValue","onUpdate:modelValue"])],64))),128))]),s("div",{class:"operate-bar",onClick:p[2]||(p[2]=t=>a.value=!a.value)},[E(l(w,null,{default:n(()=>[l(x)]),_:1},512),[[C,a.value]]),E(l(w,null,{default:n(()=>[l(q)]),_:1},512),[[C,!a.value]])])],4)}}}),ee=H(Z,[["__scopeId","data-v-d3d83a7c"]]),te={class:"editor-wrapper"},ae={class:"editor-container"},le=y({components:{"v-md-editor":T},data(){return{article:{title:"",text:"",category_id:"",tag:[],selectedTag:[],fields:[]}}},activated(){this.$route.query.cid?U.getDetail({cid:this.$route.query.cid}).then(o=>{this.article={...this.article,...o},this.article.selectedTag=this.article.tag.map(a=>a.tid),D().setArticle(this.article)}):this.data={}},methods:{saveArticle(){const o=this.$route.query.cid?"update":"add";if(!this.article.category_id)return this.$message.error("\u8BF7\u9009\u62E9\u6587\u7AE0\u5206\u7C7B");if(!this.article.fields.length)return this.$message.error("\u8BF7\u9009\u62E9\u6587\u7AE0\u6807\u7B7E");U[o](this.article).then(()=>{this.$message.success("\u4FDD\u5B58\u6210\u529F"),location.href="/admin/post-list"}).catch(e=>{this.$message.error("\u4FDD\u5B58\u5931\u8D25"),console.error(e)})},handleUploadImage(o,e,a){console.log(arguments),R.getUploadToken().then(d=>{const i=O().format("YYYY-MM-DD/HH-mm-ss");qiniu.upload(a[0],i,d).subscribe(null,null,g=>{e({url:`https://blog.cdn.thinkmoon.cn/${g.key}`})})})}}}),re=y({...le,__name:"article-editor",setup(o){return(e,a)=>{const d=c("el-input");return r(),_("div",te,[s("div",ae,[l(d,{modelValue:e.article.title,"onUpdate:modelValue":a[0]||(a[0]=i=>e.article.title=i),class:"title-input"},null,8,["modelValue"]),l(u(T),{modelValue:e.article.text,"onUpdate:modelValue":a[1]||(a[1]=i=>e.article.text=i),mode:"editable",height:"620px","disabled-menus":[],onSave:e.saveArticle,onUploadImage:e.handleUploadImage},null,8,["modelValue","onSave","onUploadImage"])]),l(ee,{article:e.article,"category-list":e.categoryList,"tag-list":e.tagList},null,8,["article","category-list","tag-list"])])}}});export{re as default};
