<!DOCTYPE html>
<html  data-head-attrs="">

<head >
  <title>自建网站对接微信公众号 | 指尖魔法屋-醉月思的博客</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><script async src="/ads.js" crossorigin="anonymous"></script><meta name="keywords" content="thinkmoon,指尖魔法屋,醉月思的博客"><meta name="description" content="web前端开发工程师、面向高保真编程、总结与记录是两个极其优秀的学习习惯、对知识和技术保持敬畏之心！"><meta name="head:count" content="5"><link rel="modulepreload" href="/_nuxt/entry-4033bfcf.mjs" as="script" crossorigin><link rel="preload" href="/_nuxt/entry.7e762317.css" as="style"><link rel="modulepreload" href="/_nuxt/default-ab4b1d95.mjs" as="script" crossorigin><link rel="preload" href="/_nuxt/default.8dc03fb7.css" as="style"><link rel="modulepreload" href="/_nuxt/Footer-39451558.mjs" as="script" crossorigin><link rel="modulepreload" href="/_nuxt/_cid_-40efc3b3.mjs" as="script" crossorigin><link rel="modulepreload" href="/_nuxt/asyncData-b0244fb3.mjs" as="script" crossorigin><link rel="prefetch" href="/_nuxt/background.36a7be78.jpg"><link rel="prefetch" as="script" href="/_nuxt/404-0c215052.mjs"><link rel="prefetch" as="script" href="/_nuxt/editor-3321b87d.mjs"><link rel="prefetch" as="script" href="/_nuxt/index-b882dfe7.mjs"><link rel="prefetch" as="script" href="/_nuxt/post-list-93b150a9.mjs"><link rel="prefetch" as="script" href="/_nuxt/admin-f89c7533.mjs"><link rel="prefetch" as="script" href="/_nuxt/_pageIndex_-08429fca.mjs"><link rel="prefetch" as="script" href="/_nuxt/PostList-693c3f84.mjs"><link rel="prefetch" as="script" href="/_nuxt/index-dbca3f00.mjs"><link rel="prefetch" as="script" href="/_nuxt/index-dc59a107.mjs"><link rel="prefetch" as="script" href="/_nuxt/login-d8f7e58b.mjs"><link rel="prefetch" as="script" href="/_nuxt/_pageIndex_-4617af3f.mjs"><link rel="prefetch" as="script" href="/_nuxt/_pageIndex_-38aaa266.mjs"><link rel="prefetch" as="script" href="/_nuxt/TagApi-b908df3a.mjs"><link rel="prefetch" as="script" href="/_nuxt/index-12cec95d.mjs"><link rel="prefetch" as="script" href="/_nuxt/auth-f948a8cb.mjs"><link rel="prefetch" as="script" href="/_nuxt/admin-1ee1b85d.mjs"><link rel="stylesheet" href="/_nuxt/entry.7e762317.css"><link rel="stylesheet" href="/_nuxt/default.8dc03fb7.css">
</head>

<body  data-head-attrs="">
  <div id="__nuxt"><!--[--><div><div class="top-menu" data-v-2d323d18><ul role="menubar" style="--el-menu-text-color:;--el-menu-hover-text-color:;--el-menu-bg-color:;--el-menu-hover-bg-color:;--el-menu-active-color:;" class="el-menu el-menu--horizontal" data-v-2d323d18><li class="el-menu-item" role="menuitem" tabindex="-1" style="" data-v-2d323d18><!--[--><!--[--> 指尖魔法屋 <!--]--><!--[--><!--]--><!--]--></li><li class="el-menu-item" role="menuitem" tabindex="-1" style="" data-v-2d323d18><!--[--><!--[--><a href="/category" class="" data-v-2d323d18> 分类 </a><!--]--><!--[--><!--]--><!--]--></li><li class="el-menu-item" role="menuitem" tabindex="-1" style="" data-v-2d323d18><!--[--><!--[--><a href="/tag" class="" data-v-2d323d18> 标签 </a><!--]--><!--[--><!--]--><!--]--></li></ul><div class="right" data-v-2d323d18><a class="el-link el-link--default" href="/login" data-v-2d323d18><!--v-if--><span class="el-link__inner"><!--[--><i class="el-icon pointer" style="font-size:26px;" data-v-2d323d18><!--[--><svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" data-v-2d323d18><path fill="currentColor" d="M512 512a192 192 0 1 0 0-384 192 192 0 0 0 0 384zm0 64a256 256 0 1 1 0-512 256 256 0 0 1 0 512zm320 320v-96a96 96 0 0 0-96-96H288a96 96 0 0 0-96 96v96a32 32 0 1 1-64 0v-96a160 160 0 0 1 160-160h448a160 160 0 0 1 160 160v96a32 32 0 1 1-64 0z"></path></svg><!--]--></i><!--]--></span><!--v-if--></a></div></div><div class="app-container"><!--[--><div class="app-container" data-v-14f20b86><!----><div class="article-content" data-v-14f20b86><div class="v-md-editor-preview" style="tab-size:2;" data-v-14f20b86><div class="github-markdown-body"><h1 data-v-md-heading="自建网站对接微信公众号" data-v-md-line="1">自建网站对接微信公众号</h1>
<blockquote data-v-md-line="2">
<p data-v-md-line="2">平常我们有些写各种网站, 个人博客系统, 物流管理系统, 通信录管理系统, 校园二手网站. 我们都知道, 只需要租用一个服务器, 再配置一个备案好的域名, 就可以在浏览器上进行访问了.<br>
不知大家, 不知大家有没有想过, 将你搭的网站对接微信公众号, 利用微信这个大用户软件, 来为你引流呢?</p>
</blockquote>
<div data-v-md-line="4">
</div><hr data-v-md-line="5">
<table data-v-md-line="6">
<thead>
<tr>
<th>本文环境</th>
<th>版本</th>
</tr>
</thead>
<tbody>
<tr>
<td>操作系统</td>
<td>Ubuntu 16.04.03</td>
</tr>
<tr>
<td>运行方式</td>
<td>VMware虚拟机</td>
</tr>
<tr>
<td>编程语言</td>
<td>PHP</td>
</tr>
<tr>
<td>项目局域网地址</td>
<td>http://192.168.253.1/audit</td>
</tr>
</tbody>
</table>
<hr data-v-md-line="12">
<p data-v-md-line="15"><img src="https://blog.cdn.thinkmoon.cn/%E5%B0%8F%E4%B9%A6%E5%8C%A0/2018-4-1523606408034.jpg" alt="enter description here"></p>
<p data-v-md-line="18">Q: 你在搞笑吗? 不是直接在微信里面打开的吗?</p>
<blockquote data-v-md-line="20">
<p data-v-md-line="20">A: 直接用微信打开是可以, 然后你在微信里面让用户再注册一个账号? 对于大部分不想麻烦的小伙伴来说, 他们会对此忘而却步. 其实微信是提供接口, 让你可以获取到微信的用户名,和用户头像的.</p>
</blockquote>
<h2 data-v-md-heading="一般来说分为三种情况" data-v-md-line="22">一般来说分为三种情况</h2>
<ol data-v-md-line="24">
<li>使用通过的微信<strong>开放</strong>平台( 注意,不是微信公众平台)</li>
</ol>
<blockquote data-v-md-line="25">
<p data-v-md-line="25">需要开发者认证</p>
</blockquote>
<ol start="2" data-v-md-line="27">
<li>使用认证过的订阅号.</li>
</ol>
<blockquote data-v-md-line="28">
<p data-v-md-line="28">需要微信认证</p>
</blockquote>
<ol start="3" data-v-md-line="30">
<li>使用认证过的服务号</li>
</ol>
<blockquote data-v-md-line="32">
<p data-v-md-line="32">需要微信认证</p>
</blockquote>
<h2 data-v-md-heading="额-那其实不是没认证就没得玩" data-v-md-line="34">额, 那其实不是没认证就没得玩?</h2>
<blockquote data-v-md-line="35">
<p data-v-md-line="35">好吧, 实际是的确如此, 不过. 如果你真的只是想玩玩. 你可以去这儿. https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login</p>
</blockquote>
<p data-v-md-line="37"><img src="https://blog.cdn.thinkmoon.cn/%E5%B0%8F%E4%B9%A6%E5%8C%A0/2018-4-1523712185351.jpg" alt="enter description here"></p>
<blockquote data-v-md-line="39">
<p data-v-md-line="39">微信测试号</p>
<h3 data-v-md-heading="优点" data-v-md-line="40">优点</h3>
<ul data-v-md-line="41">
<li>拥有几乎所有接口,</li>
<li>以及享受局域网IP回调(意思就是说,可以支持局域网, 这是正式微信平台号所不具备的)</li>
<li>发送模板消息, 不用审核.</li>
</ul>
<h3 data-v-md-heading="缺点" data-v-md-line="44">缺点</h3>
<ul data-v-md-line="45">
<li>只支持最多100个用户</li>
<li>不能设置名称, 头像.</li>
</ul>
</blockquote>
<blockquote data-v-md-line="48">
<p data-v-md-line="48">对于一些只是想玩玩, 或者小规模用户的是没有问题的.</p>
</blockquote>
<h3 data-v-md-heading="跟我一起操作" data-v-md-line="50">跟我一起操作</h3>
<h4 data-v-md-heading="登录" data-v-md-line="52">登录</h4>
<blockquote data-v-md-line="53">
<p data-v-md-line="53">扫码登录就好了;</p>
</blockquote>
<h4 data-v-md-heading="微信token" data-v-md-line="55">微信token</h4>
<blockquote data-v-md-line="56">
<p data-v-md-line="56">新建php文件(啥语言都可以,自行修改)</p>
</blockquote>
<div data-v-md-line="57"><div class="v-md-pre-wrapper v-md-pre-wrapper-php extra-class"><pre class="v-md-hljs-php"><code><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">token</span>(<span class="hljs-params"></span>)
    </span>{
        <span class="hljs-variable">$nonce</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;nonce&#x27;</span>];
        <span class="hljs-variable">$token</span> = <span class="hljs-string">&#x27;weixin&#x27;</span>;
        <span class="hljs-variable">$timestamp</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;timestamp&#x27;</span>];
        <span class="hljs-variable">$echostr</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;echostr&#x27;</span>];
        <span class="hljs-variable">$signature</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;signature&#x27;</span>];
        <span class="hljs-comment">//形成数组，然后按字典序排序</span>
        <span class="hljs-variable">$array</span> = <span class="hljs-keyword">array</span>();
        <span class="hljs-variable">$array</span> = <span class="hljs-keyword">array</span>(<span class="hljs-variable">$nonce</span>, <span class="hljs-variable">$timestamp</span>, <span class="hljs-variable">$token</span>);
        sort(<span class="hljs-variable">$array</span>);
        <span class="hljs-comment">//拼接成字符串,sha1加密 ，然后与signature进行校验</span>
        <span class="hljs-variable">$str</span> = sha1(implode(<span class="hljs-variable">$array</span>));
        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$str</span> == <span class="hljs-variable">$signature</span> &amp;&amp; <span class="hljs-variable">$echostr</span>) {
            <span class="hljs-comment">//第一次接入weixin api接口的时候</span>
            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$echostr</span>;
            <span class="hljs-keyword">exit</span>;
        }
    }
</code></pre>
</div></div><blockquote data-v-md-line="78">
<p data-v-md-line="78">然后在测试号里填写路径和token, 认证成功后就可以继续操作了</p>
</blockquote>
<p data-v-md-line="80"><img src="https://blog.cdn.thinkmoon.cn/%E5%B0%8F%E4%B9%A6%E5%8C%A0/2018-4-1523713636476.jpg" alt="enter description here"></p>
<blockquote data-v-md-line="82">
<p data-v-md-line="82">TIP: 这个链接并不需要一直可访问,<strong>只需要第一次认证通过就OK</strong>, 甚至认证过可以直接删掉.</p>
</blockquote>
<h3 data-v-md-heading="修改回调域名-接口-网页授权获取用户基本信息-修改" data-v-md-line="84">修改回调域名, 接口&gt; 网页授权获取用户基本信息 &gt; 修改</h3>
<p data-v-md-line="85"><img src="https://blog.cdn.thinkmoon.cn/%E5%B0%8F%E4%B9%A6%E5%8C%A0/2018-4-1523781481068.jpg" alt="enter description here"></p>
<blockquote data-v-md-line="86">
<p data-v-md-line="86"><strong>只有测试号支持ip</strong></p>
</blockquote>
<h3 data-v-md-heading="微信的接口" data-v-md-line="87">微信的接口</h3>
<blockquote data-v-md-line="88">
<p data-v-md-line="88">接口详情可在<em>https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1421141013</em>里查看</p>
</blockquote>
<blockquote data-v-md-line="90">
<p data-v-md-line="90"><strong>注意</strong>:</p>
<ol data-v-md-line="91">
<li>这些接口不是简单的对接就好了, 每次请求都需要携带access_token,</li>
<li>而获取access_token, 每天有获取上限.</li>
<li>access-token具有有效期(7200s) , 过期需要重新获取.</li>
</ol>
</blockquote>
<blockquote data-v-md-line="95">
<p data-v-md-line="95">获取access_token的方法<em>https://mp.weixin.qq.com/debug/cgi-bin/apiinfo?t=index&amp;type=%E5%9F%BA%E7%A1%80%E6%94%AF%E6%8C%81&amp;form=%E8%8E%B7%E5%8F%96access_token%E6%8E%A5%E5%8F%A3%20/token</em></p>
</blockquote>
<h3 data-v-md-heading="获取用户信息-实现免登录的效果" data-v-md-line="97">获取用户信息, 实现免登录的效果</h3>
<p data-v-md-line="99"><img src="https://blog.cdn.thinkmoon.cn/%E5%B0%8F%E4%B9%A6%E5%8C%A0/2018-4-1523714004736.jpg" alt="enter description here"></p>
<blockquote data-v-md-line="101">
<p data-v-md-line="101">在这儿我们需要三个接口</p>
</blockquote>
<h4 data-v-md-heading="所用接口" data-v-md-line="102">所用接口:</h4>
<blockquote data-v-md-line="103">
<p data-v-md-line="103">接口一:<br>
<em><code>https://open.weixin.qq.com/connect/oauth2/authorize?appid=APPID&amp;redirect_uri=REDIRECT_URI&amp;response_type=code&amp;scope=SCOPE&amp;state=STATE#wechat_redirect</code></em><br>
接口二:<br>
<em><code>https://api.weixin.qq.com/sns/oauth2/access_token?appid=APPID&amp;secret=SECRET&amp;code=CODE&amp;grant_type=authorization_code</code></em><br>
接口三:<br>
<em><code>https://api.weixin.qq.com/sns/userinfo?access_token=ACCESS_TOKEN&amp;openid=OPENID&amp;lang=zh_CN</code></em><br>
接口四: 刷新access_token<br>
<em><code>https://api.weixin.qq.com/sns/oauth2/refresh_token?appid=APPID&amp;grant_type=refresh_token&amp;refresh_token=REFRESH_TOKEN</code></em></p>
</blockquote>
<blockquote data-v-md-line="112">
<p data-v-md-line="112">接口返回数据, 详见<em>https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1421140842</em></p>
</blockquote>
<ol data-v-md-line="113">
<li>第一步：用户同意授权，获取code</li>
</ol>
<blockquote data-v-md-line="114">
<p data-v-md-line="114">示例:( 注意appid, redirect_url是变量)</p>
</blockquote>
<div data-v-md-line="115"><div class="v-md-pre-wrapper v-md-pre-wrapper-php extra-class"><pre class="v-md-hljs-php"><code><span class="hljs-variable">$str</span> = <span class="hljs-string">&#x27;http://open.weixin.qq.com/connect/oauth2/authorize?appid=wx20874ebf2ea1fc7f&amp;redirect_uri=&#x27;</span> . urlencode(<span class="hljs-string">&quot;http://192.168.253.1/audit/client/&quot;</span>) . <span class="hljs-string">&#x27;&amp;response_type=code&amp;scope=snsapi_base&amp;state=123#wechat_redirect&#x27;</span>;
</code></pre>
</div></div><p data-v-md-line="118"><img src="https://blog.cdn.thinkmoon.cn/%E5%B0%8F%E4%B9%A6%E5%8C%A0/2018-4-1523714822433.jpg" alt="enter description here"></p>
<ol start="2" data-v-md-line="120">
<li>第二步：通过code换取网页授权access_token</li>
</ol>
<blockquote data-v-md-line="121">
<p data-v-md-line="121">示例</p>
</blockquote>
<div data-v-md-line="122"><div class="v-md-pre-wrapper v-md-pre-wrapper-php extra-class"><pre class="v-md-hljs-php"><code><span class="hljs-variable">$data</span> = json_decode(file_get_contents(<span class="hljs-string">&quot;https://api.weixin.qq.com/sns/oauth2/access_token?appid=&quot;</span> . <span class="hljs-keyword">$this</span>-&gt;appid . <span class="hljs-string">&quot;&amp;secret=&quot;</span> . <span class="hljs-keyword">$this</span>-&gt;secret . <span class="hljs-string">&quot;&amp;code=&quot;</span> . <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>] . <span class="hljs-string">&quot;&amp;grant_type=authorization_code&quot;</span>));
</code></pre>
</div></div><blockquote data-v-md-line="125">
<p data-v-md-line="125"><strong>注意</strong>: 此处的access_token与上面的access_token不是同一个东西</p>
</blockquote>
<ol start="3" data-v-md-line="126">
<li>第三步: 通过access_token换取userinfo</li>
</ol>
<blockquote data-v-md-line="127">
<p data-v-md-line="127">示例</p>
</blockquote>
<div data-v-md-line="128"><div class="v-md-pre-wrapper v-md-pre-wrapper-php extra-class"><pre class="v-md-hljs-php"><code><span class="hljs-variable">$userInfo</span> = json_decode(file_get_contents(<span class="hljs-string">&quot;https://api.weixin.qq.com/sns/userinfo?access_token=&quot;</span> . <span class="hljs-variable">$data</span>-&gt;access_token . <span class="hljs-string">&quot;&amp;openid=&quot;</span> . <span class="hljs-variable">$data</span>-&gt;openid . <span class="hljs-string">&quot;&amp;lang=zh_CN&quot;</span>));
</code></pre>
</div></div><ol start="4" data-v-md-line="131">
<li>刷新access_token, 如果需要</li>
</ol>
<blockquote data-v-md-line="134">
<p data-v-md-line="134">这是我画的一个请求过程图, 可以帮助理解</p>
</blockquote>
<p data-v-md-line="136"><img src="https://blog.cdn.thinkmoon.cn/%E5%B0%8F%E4%B9%A6%E5%8C%A0/2018-4-%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6%20%281%29.svg" alt="enter description here" title="未命名文件 (1)"></p>
<h3 data-v-md-heading="测试演示" data-v-md-line="139">测试演示</h3>
<h4 data-v-md-heading="_1-将授权url发给手机" data-v-md-line="141">1. 将授权url发给手机</h4>
<blockquote data-v-md-line="142">
<p data-v-md-line="142">非必需, 也可以在电脑上, 也可以写到公众号子菜单中点击进入.</p>
</blockquote>
<h4 data-v-md-heading="_2-关注测试号" data-v-md-line="144">2. 关注测试号</h4>
<blockquote data-v-md-line="145">
<p data-v-md-line="145">不然会这样</p>
</blockquote>
<p data-v-md-line="147"><img src="https://blog.cdn.thinkmoon.cn/%E5%B0%8F%E4%B9%A6%E5%8C%A0/2018-4-1523781959421.jpg" alt="enter description here"></p>
<h4 data-v-md-heading="关注后点击" data-v-md-line="149">关注后点击</h4>
<p data-v-md-line="150"><img src="https://blog.cdn.thinkmoon.cn/%E5%B0%8F%E4%B9%A6%E5%8C%A0/2018-4-1523782005232.jpg" alt="enter description here"></p>
<p data-v-md-line="152"><img src="https://blog.cdn.thinkmoon.cn/%E5%B0%8F%E4%B9%A6%E5%8C%A0/2018-4-1523782015976.jpg" alt="enter description here"></p>
<h4 data-v-md-heading="测试号访问成功" data-v-md-line="154">测试号访问成功.</h4>
<blockquote data-v-md-line="155">
<p data-v-md-line="155">额, 关于后台代码原理就不讲了.<br>
类似于一个从微信服务器发来的表单, 登录进了系统, 然后再把这些数据存入数据库就好了.</p>
</blockquote>
<h3 data-v-md-heading="正式号运行效果" data-v-md-line="158">正式号运行效果</h3>
<p data-v-md-line="160"><img src="https://blog.cdn.thinkmoon.cn/%E5%B0%8F%E4%B9%A6%E5%8C%A0/2018-4-1523890856126.jpg" alt="enter description here"></p>
<p data-v-md-line="163"><img src="https://blog.cdn.thinkmoon.cn/%E5%B0%8F%E4%B9%A6%E5%8C%A0/2018-4-1523890881266.jpg" alt="enter description here"></p>
<blockquote data-v-md-line="178">
<p data-v-md-line="178">版权声明: 本文首发于<a href="https://www.thinkmoon.cn/post/530" class="custom-internal-link" target="_blank">指尖魔法屋-自建网站对接微信公众号</a>,转载或引用必须申明原指尖魔法屋来源及源地址！</p>
</blockquote>
</div></div></div></div><!--]--></div><span></span></div><div class="footer" data-v-68ae0dac><span data-v-68ae0dac>Copyright © 2017-2022 指尖魔法屋. All rights reserved</span><span data-v-68ae0dac>POWERED BY thinkBlog · v0.1.5 · build-20220508-0128</span><span data-v-68ae0dac>网站持续搭建中，感谢关注</span><span data-v-68ae0dac>本站已顽强运行：蛮久了~</span><div data-v-68ae0dac><a class="el-link el-link--primary is-underline" href="http://beian.miit.gov.cn/" data-v-68ae0dac><!--v-if--><span class="el-link__inner"><!--[--> 粤ICP备17055617号 <!--]--></span><!--v-if--></a></div></div><!--]--></div><script>window.__NUXT__=(function(a){return {data:{pinia:{},article:{cid:530,title:"自建网站对接微信公众号",created:1523517900,modified:1572255560,text:"\u003E 平常我们有些写各种网站, 个人博客系统, 物流管理系统, 通信录管理系统, 校园二手网站. 我们都知道, 只需要租用一个服务器, 再配置一个备案好的域名, 就可以在浏览器上进行访问了.\r\n\u003E 不知大家, 不知大家有没有想过, 将你搭的网站对接微信公众号, 利用微信这个大用户软件, 来为你引流呢? \r\n\u003C!-- more --\u003E\r\n***\r\n|  本文环境  |  版本  | \r\n| --- | --- | \r\n| 操作系统 |  Ubuntu 16.04.03   | \r\n| 运行方式 | VMware虚拟机   |  \r\n| 编程语言 | PHP |\r\n| 项目局域网地址 | http:\u002F\u002F192.168.253.1\u002Faudit |\r\n***\r\n \r\n\r\n![enter description here][1]\r\n\r\n\r\n Q: 你在搞笑吗? 不是直接在微信里面打开的吗?\r\n\r\n\u003E A: 直接用微信打开是可以, 然后你在微信里面让用户再注册一个账号? 对于大部分不想麻烦的小伙伴来说, 他们会对此忘而却步. 其实微信是提供接口, 让你可以获取到微信的用户名,和用户头像的. \r\n\r\n## 一般来说分为三种情况\r\n\r\n1. 使用通过的微信**开放**平台( 注意,不是微信公众平台) \r\n\u003E 需要开发者认证\r\n\r\n2. 使用认证过的订阅号.\r\n\u003E 需要微信认证\r\n\r\n3. 使用认证过的服务号\r\n\r\n\u003E 需要微信认证\r\n\r\n## 额, 那其实不是没认证就没得玩? \r\n\u003E 好吧, 实际是的确如此, 不过. 如果你真的只是想玩玩. 你可以去这儿. https:\u002F\u002Fmp.weixin.qq.com\u002Fdebug\u002Fcgi-bin\u002Fsandbox?t=sandbox\u002Flogin\r\n\r\n![enter description here][2]\r\n\r\n\u003E 微信测试号\r\n\u003E ### 优点\r\n\u003E -  拥有几乎所有接口, \r\n\u003E -  以及享受局域网IP回调(意思就是说,可以支持局域网, 这是正式微信平台号所不具备的)\r\n\u003E - 发送模板消息, 不用审核.\r\n\u003E ### 缺点\r\n\u003E - 只支持最多100个用户\r\n\u003E - 不能设置名称, 头像.\r\n\r\n\u003E 对于一些只是想玩玩, 或者小规模用户的是没有问题的.\r\n\r\n### 跟我一起操作\r\n\r\n#### 登录\r\n\u003E 扫码登录就好了;\r\n\r\n#### 微信token\r\n\u003E 新建php文件(啥语言都可以,自行修改)\r\n```php\r\npublic function token()\r\n    {\r\n        $nonce = $_GET['nonce'];\r\n        $token = 'weixin';\r\n        $timestamp = $_GET['timestamp'];\r\n        $echostr = $_GET['echostr'];\r\n        $signature = $_GET['signature'];\r\n        \u002F\u002F形成数组，然后按字典序排序\r\n        $array = array();\r\n        $array = array($nonce, $timestamp, $token);\r\n        sort($array);\r\n        \u002F\u002F拼接成字符串,sha1加密 ，然后与signature进行校验\r\n        $str = sha1(implode($array));\r\n        if ($str == $signature && $echostr) {\r\n            \u002F\u002F第一次接入weixin api接口的时候\r\n            echo $echostr;\r\n            exit;\r\n        }\r\n    }\r\n```\r\n\u003E 然后在测试号里填写路径和token, 认证成功后就可以继续操作了\r\n\r\n![enter description here][3]\r\n\r\n\u003E TIP: 这个链接并不需要一直可访问,**只需要第一次认证通过就OK**, 甚至认证过可以直接删掉.\r\n\r\n### 修改回调域名, 接口\u003E 网页授权获取用户基本信息 \u003E 修改\r\n![enter description here][4]\r\n\u003E **只有测试号支持ip**\r\n### 微信的接口\r\n\u003E 接口详情可在*https:\u002F\u002Fmp.weixin.qq.com\u002Fwiki?t=resource\u002Fres_main&id=mp1421141013*里查看\r\n\r\n\u003E**注意**: \r\n\u003E1. 这些接口不是简单的对接就好了, 每次请求都需要携带access_token,\r\n\u003E2.  而获取access_token, 每天有获取上限.\r\n\u003E3. access-token具有有效期(7200s) , 过期需要重新获取. \r\n\r\n\u003E 获取access_token的方法*https:\u002F\u002Fmp.weixin.qq.com\u002Fdebug\u002Fcgi-bin\u002Fapiinfo?t=index&type=%E5%9F%BA%E7%A1%80%E6%94%AF%E6%8C%81&form=%E8%8E%B7%E5%8F%96access_token%E6%8E%A5%E5%8F%A3%20\u002Ftoken*\r\n\r\n### 获取用户信息, 实现免登录的效果\r\n\r\n![enter description here][5]\r\n\r\n\u003E 在这儿我们需要三个接口\r\n#### 所用接口:\r\n\u003E 接口一: \r\n*`https:\u002F\u002Fopen.weixin.qq.com\u002Fconnect\u002Foauth2\u002Fauthorize?appid=APPID&redirect_uri=REDIRECT_URI&response_type=code&scope=SCOPE&state=STATE#wechat_redirect`*\r\n\u003E 接口二:\r\n*`https:\u002F\u002Fapi.weixin.qq.com\u002Fsns\u002Foauth2\u002Faccess_token?appid=APPID&secret=SECRET&code=CODE&grant_type=authorization_code`*\r\n\u003E 接口三:\r\n*`https:\u002F\u002Fapi.weixin.qq.com\u002Fsns\u002Fuserinfo?access_token=ACCESS_TOKEN&openid=OPENID&lang=zh_CN`*\r\n\u003E 接口四: 刷新access_token\r\n*`https:\u002F\u002Fapi.weixin.qq.com\u002Fsns\u002Foauth2\u002Frefresh_token?appid=APPID&grant_type=refresh_token&refresh_token=REFRESH_TOKEN`*\r\n\r\n\u003E 接口返回数据, 详见*https:\u002F\u002Fmp.weixin.qq.com\u002Fwiki?t=resource\u002Fres_main&id=mp1421140842*\r\n1. 第一步：用户同意授权，获取code\r\n\u003E 示例:( 注意appid, redirect_url是变量)\r\n```php\r\n$str = 'http:\u002F\u002Fopen.weixin.qq.com\u002Fconnect\u002Foauth2\u002Fauthorize?appid=wx20874ebf2ea1fc7f&redirect_uri=' . urlencode(\"http:\u002F\u002F192.168.253.1\u002Faudit\u002Fclient\u002F\") . '&response_type=code&scope=snsapi_base&state=123#wechat_redirect';\r\n```\r\n![enter description here][6]\r\n\r\n2. 第二步：通过code换取网页授权access_token\r\n\u003E 示例\r\n```php\r\n$data = json_decode(file_get_contents(\"https:\u002F\u002Fapi.weixin.qq.com\u002Fsns\u002Foauth2\u002Faccess_token?appid=\" . $this-\u003Eappid . \"&secret=\" . $this-\u003Esecret . \"&code=\" . $_GET['code'] . \"&grant_type=authorization_code\"));\r\n```\r\n\u003E **注意**: 此处的access_token与上面的access_token不是同一个东西\r\n3. 第三步: 通过access_token换取userinfo\r\n\u003E 示例\r\n```php\r\n$userInfo = json_decode(file_get_contents(\"https:\u002F\u002Fapi.weixin.qq.com\u002Fsns\u002Fuserinfo?access_token=\" . $data-\u003Eaccess_token . \"&openid=\" . $data-\u003Eopenid . \"&lang=zh_CN\"));\r\n```\r\n4. 刷新access_token, 如果需要\r\n\r\n\r\n\u003E 这是我画的一个请求过程图, 可以帮助理解\r\n\r\n![enter description here][7]\r\n\r\n\r\n### 测试演示\r\n\r\n#### 1. 将授权url发给手机\r\n\u003E 非必需, 也可以在电脑上, 也可以写到公众号子菜单中点击进入. \r\n\r\n#### 2. 关注测试号\r\n\u003E 不然会这样\r\n\r\n![enter description here][8]\r\n\r\n#### 关注后点击\r\n![enter description here][9]\r\n\r\n![enter description here][10]\r\n\r\n#### 测试号访问成功.\r\n\u003E 额, 关于后台代码原理就不讲了. \r\n\u003E 类似于一个从微信服务器发来的表单, 登录进了系统, 然后再把这些数据存入数据库就好了.\r\n\r\n### 正式号运行效果\r\n\r\n![enter description here][11]\r\n\r\n\r\n![enter description here][12]\r\n\r\n\r\n  [1]: https:\u002F\u002Fblog.cdn.thinkmoon.cn\u002F%E5%B0%8F%E4%B9%A6%E5%8C%A0\u002F2018-4-1523606408034.jpg\r\n  [2]: https:\u002F\u002Fblog.cdn.thinkmoon.cn\u002F%E5%B0%8F%E4%B9%A6%E5%8C%A0\u002F2018-4-1523712185351.jpg\r\n  [3]: https:\u002F\u002Fblog.cdn.thinkmoon.cn\u002F%E5%B0%8F%E4%B9%A6%E5%8C%A0\u002F2018-4-1523713636476.jpg\r\n  [4]: https:\u002F\u002Fblog.cdn.thinkmoon.cn\u002F%E5%B0%8F%E4%B9%A6%E5%8C%A0\u002F2018-4-1523781481068.jpg\r\n  [5]: https:\u002F\u002Fblog.cdn.thinkmoon.cn\u002F%E5%B0%8F%E4%B9%A6%E5%8C%A0\u002F2018-4-1523714004736.jpg\r\n  [6]: https:\u002F\u002Fblog.cdn.thinkmoon.cn\u002F%E5%B0%8F%E4%B9%A6%E5%8C%A0\u002F2018-4-1523714822433.jpg\r\n  [7]: https:\u002F\u002Fblog.cdn.thinkmoon.cn\u002F%E5%B0%8F%E4%B9%A6%E5%8C%A0\u002F2018-4-%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6%20%281%29.svg \"未命名文件 &#40;1&#41;\"\r\n  [8]: https:\u002F\u002Fblog.cdn.thinkmoon.cn\u002F%E5%B0%8F%E4%B9%A6%E5%8C%A0\u002F2018-4-1523781959421.jpg\r\n  [9]: https:\u002F\u002Fblog.cdn.thinkmoon.cn\u002F%E5%B0%8F%E4%B9%A6%E5%8C%A0\u002F2018-4-1523782005232.jpg\r\n  [10]: https:\u002F\u002Fblog.cdn.thinkmoon.cn\u002F%E5%B0%8F%E4%B9%A6%E5%8C%A0\u002F2018-4-1523782015976.jpg\r\n  [11]: https:\u002F\u002Fblog.cdn.thinkmoon.cn\u002F%E5%B0%8F%E4%B9%A6%E5%8C%A0\u002F2018-4-1523890856126.jpg\r\n  [12]: https:\u002F\u002Fblog.cdn.thinkmoon.cn\u002F%E5%B0%8F%E4%B9%A6%E5%8C%A0\u002F2018-4-1523890881266.jpg",authorId:a,comments:a,views:528,likes:a,tag:[],category:"教程分享",category_id:14,fields:{}}},state:{error:null},_errors:{},serverRendered:true,config:{public:{TITLE:"指尖魔法屋-醉月思的博客",VERSION:"0.1.5 · build-20220508-0128",KEYWORDS:["thinkmoon","指尖魔法屋","醉月思的博客"],DESCRIPTION:"web前端开发工程师、面向高保真编程、总结与记录是两个极其优秀的学习习惯、对知识和技术保持敬畏之心！",baseUrl:"https:\u002F\u002Fservice.thinkmoon.cn\u002Fapi"},app:{baseURL:"\u002F",buildAssetsDir:"\u002F_nuxt\u002F",cdnURL:""}}}}(0))</script><script type="module" src="/_nuxt/entry-4033bfcf.mjs" crossorigin></script><script type="module" src="/_nuxt/default-ab4b1d95.mjs" crossorigin></script><script type="module" src="/_nuxt/_cid_-40efc3b3.mjs" crossorigin></script>
</body>

</html>