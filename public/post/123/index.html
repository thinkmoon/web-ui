<!DOCTYPE html>
<html  data-head-attrs="">

<head >
  <title>微信小程序svg转canvas | 指尖魔法屋-醉月思的博客</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><script async src="/ads.js" crossorigin="anonymous"></script><meta name="keywords" content="nodejs"><meta name="description" content="web前端开发工程师、面向高保真编程、总结与记录是两个极其优秀的学习习惯、对知识和技术保持敬畏之心！"><meta name="head:count" content="5"><link rel="modulepreload" href="/nuxt-asset/entry-b3d792ef.mjs" as="script" crossorigin><link rel="preload" href="/nuxt-asset/entry.33c2be2f.css" as="style"><link rel="modulepreload" href="/nuxt-asset/default-97382c0d.mjs" as="script" crossorigin><link rel="preload" href="/nuxt-asset/default.7e78eff2.css" as="style"><link rel="modulepreload" href="/nuxt-asset/Footer-93f94e0d.mjs" as="script" crossorigin><link rel="modulepreload" href="/nuxt-asset/_cid_-e1fa34ae.mjs" as="script" crossorigin><link rel="modulepreload" href="/nuxt-asset/asyncData-7c982d20.mjs" as="script" crossorigin><link rel="prefetch" href="/nuxt-asset/background.36a7be78.jpg"><link rel="prefetch" as="script" href="/nuxt-asset/404-18052e4e.mjs"><link rel="prefetch" as="script" href="/nuxt-asset/editor-e4fe624c.mjs"><link rel="prefetch" as="script" href="/nuxt-asset/index-55c4e492.mjs"><link rel="prefetch" as="script" href="/nuxt-asset/post-list-951d2338.mjs"><link rel="prefetch" as="script" href="/nuxt-asset/admin-e66dd82d.mjs"><link rel="prefetch" as="script" href="/nuxt-asset/_pageIndex_-31e6dfdb.mjs"><link rel="prefetch" as="script" href="/nuxt-asset/PostList-c8f2b0c3.mjs"><link rel="prefetch" as="script" href="/nuxt-asset/index-df291e85.mjs"><link rel="prefetch" as="script" href="/nuxt-asset/index-4145c5d0.mjs"><link rel="prefetch" as="script" href="/nuxt-asset/login-40ff46e4.mjs"><link rel="prefetch" as="script" href="/nuxt-asset/_pageIndex_-6864f1f4.mjs"><link rel="prefetch" as="script" href="/nuxt-asset/_pageIndex_-bcc6693a.mjs"><link rel="prefetch" as="script" href="/nuxt-asset/TagApi-bbbee3b0.mjs"><link rel="prefetch" as="script" href="/nuxt-asset/index-a8c6da2a.mjs"><link rel="prefetch" as="script" href="/nuxt-asset/auth-5b00f9d9.mjs"><link rel="prefetch" as="script" href="/nuxt-asset/admin-3c1a56ec.mjs"><link rel="stylesheet" href="/nuxt-asset/entry.33c2be2f.css"><link rel="stylesheet" href="/nuxt-asset/default.7e78eff2.css">
</head>

<body  data-head-attrs="">
  <div id="__nuxt"><!--[--><div data-v-062e129b><div class="top-menu" data-v-062e129b data-v-cb59d91c><div class="left" data-v-cb59d91c><a class="el-link el-link--default is-underline" href="/" data-v-cb59d91c><!--v-if--><span class="el-link__inner"><!--[-->指尖魔法屋<!--]--></span><!--v-if--></a></div><ul role="menubar" style="--el-menu-text-color:;--el-menu-hover-text-color:;--el-menu-bg-color:;--el-menu-hover-bg-color:;--el-menu-active-color:;" class="el-menu el-menu--horizontal" data-v-cb59d91c><li class="el-menu-item" role="menuitem" tabindex="-1" style="" data-v-cb59d91c><!--[--><!--[--> 首页 <!--]--><!--[--><!--]--><!--]--></li><li class="el-menu-item" role="menuitem" tabindex="-1" style="" data-v-cb59d91c><!--[--><!--[--><a href="/category" class="" data-v-cb59d91c> 分类 </a><!--]--><!--[--><!--]--><!--]--></li><li class="el-menu-item" role="menuitem" tabindex="-1" style="" data-v-cb59d91c><!--[--><!--[--><a href="/tag" class="" data-v-cb59d91c> 标签 </a><!--]--><!--[--><!--]--><!--]--></li></ul><div class="right" data-v-cb59d91c><a class="el-link el-link--default" href="/login" data-v-cb59d91c><!--v-if--><span class="el-link__inner"><!--[--><i class="el-icon pointer" style="font-size:26px;" data-v-cb59d91c><!--[--><svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" data-v-cb59d91c><path fill="currentColor" d="M512 512a192 192 0 1 0 0-384 192 192 0 0 0 0 384zm0 64a256 256 0 1 1 0-512 256 256 0 0 1 0 512zm320 320v-96a96 96 0 0 0-96-96H288a96 96 0 0 0-96 96v96a32 32 0 1 1-64 0v-96a160 160 0 0 1 160-160h448a160 160 0 0 1 160 160v96a32 32 0 1 1-64 0z"></path></svg><!--]--></i><!--]--></span><!--v-if--></a></div></div><div class="app-container" data-v-062e129b><div class="layout" data-v-062e129b><div class="main-content" data-v-062e129b><!--[--><div class="" data-v-4b611cb2><!----><div class="article-content" data-v-4b611cb2><div class="v-md-editor-preview" style="tab-size:2;" data-v-4b611cb2><div class="github-markdown-body"><h1 data-v-md-heading="微信小程序svg转canvas" data-v-md-line="1">微信小程序svg转canvas</h1>
<blockquote data-v-md-line="2">
<blockquote data-v-md-line="2">
<p data-v-md-line="2">首先，为什么我们需要这个？</p>
</blockquote>
<p data-v-md-line="4">因为微信小程序虽然可以可以绘制svg图片，但是在真机调试的时候却渲染不出来。所以我们需要一个工具(可以将svg转成微信小程序支持的canvas并绘制出来)。</p>
</blockquote>
<p data-v-md-line="6">我使用的是touch-wx + vs code 开发。</p>
<blockquote data-v-md-line="8">
<p data-v-md-line="8">现已启用该开发模式.因为Ubuntu下经常编译不完整</p>
</blockquote>
<h2 data-v-md-heading="touch-wx-是什么" data-v-md-line="10">Touch WX 是什么？</h2>
<p data-v-md-line="12"><img src="https://blog.cdn.thinkmoon.cn/TIM%E6%88%AA%E5%9B%BE20180620111841.png" alt="Touch WX"></p>
<p data-v-md-line="14">Touch WX是一套完全免费的微信小程序开发框架，包含丰富的UI控件用于官方组件的补充。与Touch UI开发方式很相似，也是通过VSCode编辑器+插件的方式开发，经过编译后输出小程序代码。<br>
与其他小程序框架最主要的区别在于：Touch UI完全是基于小程序官方的自定义组件机制实现，输出的是小程序原始代码，而不是输出开发者完全无法阅读的编译代码。这样当遇到问题时，开发者可以很方便的定位问题所在，还可以基于输出的原始代码继续开发。<br>
当你用Touch UI开发了H5应用，可以直接导入到Touch WX进行转换，稍作调整就能生成小程序。反之也同样，当你Touch WX开发了微信小程序，可以导出为Touch UI工程来生成H5应用。</p>
<h2 data-v-md-heading="touch-wx-的特点" data-v-md-line="18">Touch WX 的特点</h2>
<p data-v-md-line="20"><img src="https://blog.cdn.thinkmoon.cn/TIM%E6%88%AA%E5%9B%BE20180620111451.png" alt="Touch WX"></p>
<h3 data-v-md-heading="我的理解" data-v-md-line="22">我的理解</h3>
<blockquote data-v-md-line="24">
<p data-v-md-line="24">Touch WX 就是一个可以将特定的nodejs项目编译成微信小程序项目的框架</p>
</blockquote>
<h3 data-v-md-heading="touch-wx更多操作" data-v-md-line="26">Touch WX更多操作</h3>
<blockquote data-v-md-line="28">
<p data-v-md-line="28">更多操作见http://www.touchui.io/touchui_doc_wx/</p>
</blockquote>
<p data-v-md-line="30">推荐大家看一下，或许会打开新世界的大门哦！</p>
<blockquote data-v-md-line="32">
<p data-v-md-line="32">接下来，我默认你已经看了Touch WX的文档，并且拥有一定的nodejs基础</p>
</blockquote>
<h2 data-v-md-heading="开始流程" data-v-md-line="34">开始流程</h2>
<h3 data-v-md-heading="安装parse-svg-path" data-v-md-line="36">安装parse-svg-path</h3>
<blockquote data-v-md-line="38">
<p data-v-md-line="38"><code>npm install parse-svg-path --save</code></p>
</blockquote>
<h3 data-v-md-heading="引入parse-svg-path" data-v-md-line="40">引入parse-svg-path</h3>
<blockquote data-v-md-line="42">
<p data-v-md-line="42"><code>var parse = require('parse-svg-path')</code></p>
</blockquote>
<h3 data-v-md-heading="使用parse-svg-path" data-v-md-line="44">使用parse-svg-path</h3>
<blockquote data-v-md-line="46">
<p data-v-md-line="46"><code>parse(d)</code></p>
</blockquote>
<p data-v-md-line="48"><code>d</code>为svg中的path值</p>
<blockquote data-v-md-line="50">
<blockquote data-v-md-line="50">
<p data-v-md-line="50">不了解svg？</p>
</blockquote>
<p data-v-md-line="52">请转<code>http://www.w3school.com.cn/svg/svg_intro.asp</code></p>
</blockquote>
<h2 data-v-md-heading="如何获得path值" data-v-md-line="54">如何获得path值？</h2>
<div data-v-md-line="55"><div class="v-md-pre-wrapper v-md-pre-wrapper-JavaScript extra-class"><pre class="v-md-hljs-JavaScript"><code><span class="hljs-keyword">var</span> options = {
            <span class="hljs-attr">url</span>:<span class="hljs-string">&quot;svg的URL&quot;</span>,
            <span class="hljs-attr">success</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>)</span>{
              <span class="hljs-keyword">const</span> ctx = wx.createCanvasContext(<span class="hljs-string">&#x27;myCanvas&#x27;</span>)
              ctx.setFillStyle(<span class="hljs-string">&#x27;black&#x27;</span>)
              <span class="hljs-keyword">var</span> match = res.data.match(<span class="hljs-regexp">/d=&quot;(.*?)&quot;/</span>);
              <span class="hljs-keyword">var</span> d = match[<span class="hljs-number">1</span>];
              <span class="hljs-built_in">console</span>.log(d);
            }
    }
    wx.request(options); 
</code></pre>
</div></div><blockquote data-v-md-line="68">
<p data-v-md-line="68">上图中d就是path值，我这里使用的是正则表达式查找，而且只有一个path，如不一样，请自行modify</p>
</blockquote>
<h2 data-v-md-heading="解析后的值" data-v-md-line="70">解析后的值</h2>
<div data-v-md-line="71"><div class="v-md-pre-wrapper v-md-pre-wrapper-JavaScript extra-class"><pre class="v-md-hljs-JavaScript"><code><span class="hljs-built_in">console</span>.log(parse(d));
</code></pre>
</div></div><p data-v-md-line="74"><img src="https://blog.cdn.thinkmoon.cn/TIM%E6%88%AA%E5%9B%BE20180620113452.png" alt="效果展示"></p>
<blockquote data-v-md-line="76">
<p data-v-md-line="76">解析之后是一系列的操作序列数组</p>
</blockquote>
<h2 data-v-md-heading="绘制图形" data-v-md-line="78">绘制图形</h2>
<blockquote data-v-md-line="80">
<p data-v-md-line="80">根据一系列的操作，找到对应的微信小程序绘制API，进行绘制</p>
</blockquote>
<div data-v-md-line="81"><div class="v-md-pre-wrapper v-md-pre-wrapper-JavaScript extra-class"><pre class="v-md-hljs-JavaScript"><code>parse(d).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">element</span>)</span>{
                <span class="hljs-keyword">if</span>(element[<span class="hljs-number">0</span>] == <span class="hljs-string">&quot;M&quot;</span>){
                  ctx.moveTo(element[<span class="hljs-number">1</span>], element[<span class="hljs-number">2</span>])
                }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(element[<span class="hljs-number">0</span>] == <span class="hljs-string">&quot;Q&quot;</span>){
                  ctx.quadraticCurveTo(element[<span class="hljs-number">1</span>], element[<span class="hljs-number">2</span>], element[<span class="hljs-number">3</span>], element[<span class="hljs-number">4</span>])
                }
              });
</code></pre>
</div></div><blockquote data-v-md-line="91">
<p data-v-md-line="91">因为我这里只有M，Q操作所以我只用了两个API，可根据实际情况自行拓展</p>
</blockquote>
<h2 data-v-md-heading="实例代码" data-v-md-line="93">实例代码</h2>
<p data-v-md-line="94"><code>display.wx</code></p>
<div data-v-md-line="95"><div class="v-md-pre-wrapper v-md-pre-wrapper-JavaScript extra-class"><pre class="v-md-hljs-JavaScript"><code>&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&#x27;page&#x27;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">canvas-id</span>=<span class="hljs-string">&quot;myCanvas&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;border: 1px solid;&quot;</span>/&gt;</span>
    <span class="hljs-comment">&lt;!-- &lt;view class=&#x27;content&#x27;&gt;&lt;text class=&quot;zhuan&quot; style=&quot;font-size:{{fontSize}}pt&quot;&gt;{{display}}&lt;/text&gt; --&gt;</span>
  <span class="hljs-comment">&lt;!-- &lt;/view&gt; --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">var</span> parse = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;parse-svg-path&#x27;</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">config</span>: {
    <span class="hljs-attr">navigationBarTitleText</span>: <span class="hljs-string">&#x27;效果展示&#x27;</span>
  },
  <span class="hljs-attr">data</span>: {},
  <span class="hljs-attr">onLoad</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">options</span>) </span>{
    <span class="hljs-keyword">var</span> str = options.display;
    <span class="hljs-keyword">if</span>(str != <span class="hljs-literal">null</span>){
      <span class="hljs-keyword">try</span> {
        str=<span class="hljs-built_in">decodeURI</span>(str);
        wx.setStorageSync(<span class="hljs-string">&#x27;display&#x27;</span>, str)
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;接受到的str：&quot;</span>+str);
      } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;设置diaplay值错误&quot;</span>)
      }
    }  
  },

  <span class="hljs-comment">/**
   * 生命周期函数--监听页面初次渲染完成
   */</span>
  <span class="hljs-attr">onReady</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  
  },
  <span class="hljs-function"><span class="hljs-title">saveTemp</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;fdsaf&quot;</span>);
    wx.canvasToTempFilePath({
      <span class="hljs-attr">canvasId</span>: <span class="hljs-string">&#x27;myCanvas&#x27;</span>,
      <span class="hljs-attr">fail</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>) </span>{
        <span class="hljs-built_in">console</span>.log(res);
      },
      <span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>) </span>{
        <span class="hljs-built_in">console</span>.log(res.tempFilePath)
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{wx.saveImageToPhotosAlbum({
          <span class="hljs-attr">filePath</span>:res.tempFilePath,
          <span class="hljs-attr">fail</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>)</span>{
            <span class="hljs-built_in">console</span>.log(res);
          }
          
          });},<span class="hljs-number">5000</span>)
        
      },
       
    })
  },
  <span class="hljs-comment">/**
   * 生命周期函数--监听页面显示
   */</span>
  <span class="hljs-attr">onShow</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> that = <span class="hljs-built_in">this</span>;
    
    <span class="hljs-keyword">var</span> options = {
            <span class="hljs-attr">url</span>:<span class="hljs-string">&quot;http://mp.thinkmoon.cn:39999?str=我&amp;site=0&quot;</span>,
            <span class="hljs-attr">success</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>)</span>{
              <span class="hljs-keyword">const</span> ctx = wx.createCanvasContext(<span class="hljs-string">&#x27;myCanvas&#x27;</span>)
              ctx.setFillStyle(<span class="hljs-string">&#x27;black&#x27;</span>)
              <span class="hljs-keyword">var</span> match = res.data.match(<span class="hljs-regexp">/d=&quot;(.*?)&quot;/</span>);
              <span class="hljs-keyword">var</span> d = match[<span class="hljs-number">1</span>];
              <span class="hljs-built_in">console</span>.log(parse(d))
              parse(d).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">element</span>)</span>{
                <span class="hljs-keyword">if</span>(element[<span class="hljs-number">0</span>] == <span class="hljs-string">&quot;M&quot;</span>){
                  ctx.moveTo(element[<span class="hljs-number">1</span>], element[<span class="hljs-number">2</span>])
                }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(element[<span class="hljs-number">0</span>] == <span class="hljs-string">&quot;Q&quot;</span>){
                  ctx.quadraticCurveTo(element[<span class="hljs-number">1</span>], element[<span class="hljs-number">2</span>], element[<span class="hljs-number">3</span>], element[<span class="hljs-number">4</span>])
                }
              });
              ctx.fill();
              ctx.draw(<span class="hljs-literal">false</span>,<span class="hljs-function">()=&gt;</span>{<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {that.saveTemp()},<span class="hljs-number">5000</span>);});
            }
    }
    wx.request(options); 
    <span class="hljs-comment">// wx.getStorage({</span>
    <span class="hljs-comment">//   key: &#x27;display&#x27;,</span>
    <span class="hljs-comment">//   success: function (res) {</span>
    <span class="hljs-comment">//     console.log(&quot;display的值为&quot; + res.data)</span>
    <span class="hljs-comment">//     that.setData({</span>
    <span class="hljs-comment">//       display: res.data,</span>
    <span class="hljs-comment">//       fontSize: wx.getStorageSync(&#x27;pt&#x27;)</span>
    <span class="hljs-comment">//     })</span>
    <span class="hljs-comment">//   }</span>
    <span class="hljs-comment">// })</span>
  },

  <span class="hljs-comment">/**
   * 生命周期函数--监听页面隐藏
   */</span>
  <span class="hljs-attr">onHide</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  
  },

  <span class="hljs-comment">/**
   * 生命周期函数--监听页面卸载
   */</span>
  <span class="hljs-attr">onUnload</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  
  },

  <span class="hljs-comment">/**
   * 页面相关事件处理函数--监听用户下拉动作
   */</span>
  <span class="hljs-attr">onPullDownRefresh</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  
  },

  <span class="hljs-comment">/**
   * 页面上拉触底事件的处理函数
   */</span>
  <span class="hljs-attr">onReachBottom</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  
  },

  <span class="hljs-comment">/**
   * 用户点击右上角分享
   */</span>
  <span class="hljs-attr">onShareAppMessage</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> str = <span class="hljs-built_in">this</span>.data.display;
    <span class="hljs-keyword">var</span> pages = getCurrentPages()    <span class="hljs-comment">//获取加载的页面</span>
    <span class="hljs-keyword">var</span> currentPage = pages[pages.length - <span class="hljs-number">1</span>]    <span class="hljs-comment">//获取当前页面的对象</span>
    <span class="hljs-keyword">var</span> url = currentPage.route
    <span class="hljs-keyword">var</span> inUrl = url + <span class="hljs-string">&quot;?display=&quot;</span> + <span class="hljs-built_in">encodeURI</span>(str);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;分享的链接为&quot;</span>+inUrl);
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;您的好友给您分享了一段篆文&#x27;</span>,
      <span class="hljs-attr">path</span>: inUrl,
      <span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>{
        <span class="hljs-comment">// 转发成功</span>
      },
      <span class="hljs-attr">fail</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>{
        <span class="hljs-comment">// 转发失败</span>
      }
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;less&quot;</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.content</span>{
  <span class="hljs-attribute">text-align</span>: center;
}
<span class="hljs-selector-tag">canvas</span>{
  <span class="hljs-attribute">width</span>: <span class="hljs-number">256px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">256px</span>;
}

</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>

</code></pre>
</div></div><h2 data-v-md-heading="后记" data-v-md-line="254">后记</h2>
<blockquote data-v-md-line="255">
<p data-v-md-line="255">我这个实例本来是将svg转canvas绘制出来，再转图片，下载到本地的。但是因为draw()函数是异步的所以需要等待。才可以下载成功，否则会出现一片黑的情况，总之感觉各种麻烦。再加上画布的大小难以设置。后我还是选择在服务端生成图片再转发过来。</p>
</blockquote>
<h2 data-v-md-heading="参考文献" data-v-md-line="257">参考文献</h2>
<ol data-v-md-line="258">
<li><a href="http://www.w3school.com.cn/svg/svg_intro.asp" class="custom-external-link" rel="nofollow noopener noreferrer" target="_blank">SVG简介</a></li>
<li><a href="http://www.touchui.io/touchui_doc_wx/" class="custom-external-link" rel="nofollow noopener noreferrer" target="_blank">Touch WX开发文档</a></li>
<li><a href="https://developers.weixin.qq.com/miniprogram/dev/api/canvas/intro.html" class="custom-external-link" rel="nofollow noopener noreferrer" target="_blank">微信开发文档Canvas</a></li>
</ol>
<blockquote data-v-md-line="261">
<p data-v-md-line="261">版权声明: 本文首发于<a href="https://www.thinkmoon.cn/post/123" class="custom-internal-link" target="_blank">指尖魔法屋-微信小程序svg转canvas</a>,转载或引用必须申明原指尖魔法屋来源及源地址！</p>
</blockquote>
</div></div><ins class="adsbygoogle" data-ad-client="ca-pub-3208634444966567" data-ad-format="fluid" data-ad-layout="in-article" data-ad-slot="2621880404" style="display:block;text-align:center;width:100%;" data-v-4b611cb2></ins></div></div><!--]--></div><div class="page-section" data-v-062e129b><div class="section" data-v-062e129b><div class="el-input el-input-group el-input-group--append input-with-select" style=""><!-- input --><!--[--><!-- prepend slot --><!--v-if--><div class="el-input__wrapper"><!-- prefix slot --><!--v-if--><input class="el-input__inner" type="text" autocomplete="off" tabindex="0" placeholder="站内搜索" style=""><!-- suffix slot --><!--v-if--></div><!-- append slot --><div class="el-input-group__append"><!--[--><button class="el-button" aria-disabled="false" type="button" style=""><i class="el-icon" style=""><!--[--><svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="m795.904 750.72 124.992 124.928a32 32 0 0 1-45.248 45.248L750.656 795.904a416 416 0 1 1 45.248-45.248zM480 832a352 352 0 1 0 0-704 352 352 0 0 0 0 704z"></path></svg><!--]--></i><!--v-if--></button><!--]--></div><!--]--></div></div><div class="section" data-v-062e129b><ins class="adsbygoogle" data-ad-client="ca-pub-3208634444966567" data-ad-format="auto" data-ad-slot="2184618903" data-full-width-responsive="true" style="display:block;"></ins></div></div></div></div><span data-v-062e129b></span></div><div class="footer" data-v-062e129b data-v-68ae0dac><span data-v-68ae0dac>Copyright © 2017-2022 指尖魔法屋. All rights reserved</span><span data-v-68ae0dac>POWERED BY thinkBlog · v0.1.7 · build-20220516</span><span data-v-68ae0dac>网站持续搭建中，感谢关注</span><span data-v-68ae0dac>本站已顽强运行：蛮久了~</span><div data-v-68ae0dac><a class="el-link el-link--primary is-underline" href="http://beian.miit.gov.cn/" data-v-68ae0dac><!--v-if--><span class="el-link__inner"><!--[--> 粤ICP备17055617号 <!--]--></span><!--v-if--></a></div></div><!--]--></div><script>window.__NUXT__=(function(a){return {data:{pinia:{},article:{cid:123,title:"微信小程序svg转canvas",created:1529463840,modified:1548079672,text:"\u003E \u003E首先，为什么我们需要这个？\r\n\u003E \r\n\u003E 因为微信小程序虽然可以可以绘制svg图片，但是在真机调试的时候却渲染不出来。所以我们需要一个工具(可以将svg转成微信小程序支持的canvas并绘制出来)。\r\n\r\n我使用的是touch-wx + vs code 开发。\r\n\r\n\u003E 现已启用该开发模式.因为Ubuntu下经常编译不完整\r\n\r\n## Touch WX 是什么？\r\n\r\n![Touch WX](https:\u002F\u002Fblog.cdn.thinkmoon.cn\u002FTIM%E6%88%AA%E5%9B%BE20180620111841.png)\r\n\r\nTouch WX是一套完全免费的微信小程序开发框架，包含丰富的UI控件用于官方组件的补充。与Touch UI开发方式很相似，也是通过VSCode编辑器+插件的方式开发，经过编译后输出小程序代码。\r\n与其他小程序框架最主要的区别在于：Touch UI完全是基于小程序官方的自定义组件机制实现，输出的是小程序原始代码，而不是输出开发者完全无法阅读的编译代码。这样当遇到问题时，开发者可以很方便的定位问题所在，还可以基于输出的原始代码继续开发。\r\n当你用Touch UI开发了H5应用，可以直接导入到Touch WX进行转换，稍作调整就能生成小程序。反之也同样，当你Touch WX开发了微信小程序，可以导出为Touch UI工程来生成H5应用。\r\n\r\n## Touch WX 的特点\r\n\r\n![Touch WX](https:\u002F\u002Fblog.cdn.thinkmoon.cn\u002FTIM%E6%88%AA%E5%9B%BE20180620111451.png)\r\n\r\n### 我的理解\r\n\r\n\u003E Touch WX 就是一个可以将特定的nodejs项目编译成微信小程序项目的框架\r\n\r\n### Touch WX更多操作\r\n\r\n\u003E 更多操作见http:\u002F\u002Fwww.touchui.io\u002Ftouchui_doc_wx\u002F\r\n\r\n推荐大家看一下，或许会打开新世界的大门哦！\r\n\r\n\u003E 接下来，我默认你已经看了Touch WX的文档，并且拥有一定的nodejs基础\r\n\r\n## 开始流程\r\n\r\n### 安装parse-svg-path\r\n\r\n\u003E `npm install parse-svg-path --save`\r\n\r\n### 引入parse-svg-path\r\n\r\n\u003E `var parse = require('parse-svg-path')`\r\n\r\n### 使用parse-svg-path\r\n\r\n\u003E `parse(d)`\r\n\r\n`d`为svg中的path值\r\n\r\n\u003E \u003E不了解svg？\r\n\u003E \r\n\u003E 请转`http:\u002F\u002Fwww.w3school.com.cn\u002Fsvg\u002Fsvg_intro.asp`\r\n\r\n## 如何获得path值？\r\n```JavaScript\r\nvar options = {\r\n            url:\"svg的URL\",\r\n            success:function(res){\r\n              const ctx = wx.createCanvasContext('myCanvas')\r\n              ctx.setFillStyle('black')\r\n              var match = res.data.match(\u002Fd=\"(.*?)\"\u002F);\r\n              var d = match[1];\r\n              console.log(d);\r\n            }\r\n    }\r\n    wx.request(options); \r\n```\r\n\u003E 上图中d就是path值，我这里使用的是正则表达式查找，而且只有一个path，如不一样，请自行modify\r\n\r\n## 解析后的值\r\n```JavaScript\r\nconsole.log(parse(d));\r\n```\r\n![效果展示](https:\u002F\u002Fblog.cdn.thinkmoon.cn\u002FTIM%E6%88%AA%E5%9B%BE20180620113452.png)\r\n\r\n\u003E 解析之后是一系列的操作序列数组\r\n\r\n## 绘制图形\r\n\r\n\u003E 根据一系列的操作，找到对应的微信小程序绘制API，进行绘制\r\n```JavaScript\r\nparse(d).forEach(function (element){\r\n                if(element[0] == \"M\"){\r\n                  ctx.moveTo(element[1], element[2])\r\n                }else if(element[0] == \"Q\"){\r\n                  ctx.quadraticCurveTo(element[1], element[2], element[3], element[4])\r\n                }\r\n              });\r\n```\r\n\r\n\u003E 因为我这里只有M，Q操作所以我只用了两个API，可根据实际情况自行拓展\r\n\r\n## 实例代码\r\n`display.wx`\r\n```JavaScript\r\n\u003Ctemplate\u003E\r\n  \u003Cview class='page'\u003E\r\n    \u003Ccanvas canvas-id=\"myCanvas\" style=\"border: 1px solid;\"\u002F\u003E\r\n    \u003C!-- \u003Cview class='content'\u003E\u003Ctext class=\"zhuan\" style=\"font-size:{{fontSize}}pt\"\u003E{{display}}\u003C\u002Ftext\u003E --\u003E\r\n  \u003C!-- \u003C\u002Fview\u003E --\u003E\r\n\u003C\u002Fview\u003E\r\n\u003C\u002Ftemplate\u003E\r\n\r\n\u003Cscript\u003E\r\nvar parse = require('parse-svg-path')\r\nexport default {\r\n  config: {\r\n    navigationBarTitleText: '效果展示'\r\n  },\r\n  data: {},\r\n  onLoad: function (options) {\r\n    var str = options.display;\r\n    if(str != null){\r\n      try {\r\n        str=decodeURI(str);\r\n        wx.setStorageSync('display', str)\r\n        console.log(\"接受到的str：\"+str);\r\n      } catch (e) {\r\n        console.log(\"设置diaplay值错误\")\r\n      }\r\n    }  \r\n  },\r\n\r\n  \u002F**\r\n   * 生命周期函数--监听页面初次渲染完成\r\n   *\u002F\r\n  onReady: function () {\r\n  \r\n  },\r\n  saveTemp(){\r\n    console.log(\"fdsaf\");\r\n    wx.canvasToTempFilePath({\r\n      canvasId: 'myCanvas',\r\n      fail: function(res) {\r\n        console.log(res);\r\n      },\r\n      success: function(res) {\r\n        console.log(res.tempFilePath)\r\n        setTimeout(function(){wx.saveImageToPhotosAlbum({\r\n          filePath:res.tempFilePath,\r\n          fail:function(res){\r\n            console.log(res);\r\n          }\r\n          \r\n          });},5000)\r\n        \r\n      },\r\n       \r\n    })\r\n  },\r\n  \u002F**\r\n   * 生命周期函数--监听页面显示\r\n   *\u002F\r\n  onShow: function () {\r\n    var that = this;\r\n    \r\n    var options = {\r\n            url:\"http:\u002F\u002Fmp.thinkmoon.cn:39999?str=我&site=0\",\r\n            success:function(res){\r\n              const ctx = wx.createCanvasContext('myCanvas')\r\n              ctx.setFillStyle('black')\r\n              var match = res.data.match(\u002Fd=\"(.*?)\"\u002F);\r\n              var d = match[1];\r\n              console.log(parse(d))\r\n              parse(d).forEach(function (element){\r\n                if(element[0] == \"M\"){\r\n                  ctx.moveTo(element[1], element[2])\r\n                }else if(element[0] == \"Q\"){\r\n                  ctx.quadraticCurveTo(element[1], element[2], element[3], element[4])\r\n                }\r\n              });\r\n              ctx.fill();\r\n              ctx.draw(false,()=\u003E{setTimeout(() =\u003E {that.saveTemp()},5000);});\r\n            }\r\n    }\r\n    wx.request(options); \r\n    \u002F\u002F wx.getStorage({\r\n    \u002F\u002F   key: 'display',\r\n    \u002F\u002F   success: function (res) {\r\n    \u002F\u002F     console.log(\"display的值为\" + res.data)\r\n    \u002F\u002F     that.setData({\r\n    \u002F\u002F       display: res.data,\r\n    \u002F\u002F       fontSize: wx.getStorageSync('pt')\r\n    \u002F\u002F     })\r\n    \u002F\u002F   }\r\n    \u002F\u002F })\r\n  },\r\n\r\n  \u002F**\r\n   * 生命周期函数--监听页面隐藏\r\n   *\u002F\r\n  onHide: function () {\r\n  \r\n  },\r\n\r\n  \u002F**\r\n   * 生命周期函数--监听页面卸载\r\n   *\u002F\r\n  onUnload: function () {\r\n  \r\n  },\r\n\r\n  \u002F**\r\n   * 页面相关事件处理函数--监听用户下拉动作\r\n   *\u002F\r\n  onPullDownRefresh: function () {\r\n  \r\n  },\r\n\r\n  \u002F**\r\n   * 页面上拉触底事件的处理函数\r\n   *\u002F\r\n  onReachBottom: function () {\r\n  \r\n  },\r\n\r\n  \u002F**\r\n   * 用户点击右上角分享\r\n   *\u002F\r\n  onShareAppMessage: function () {\r\n    var str = this.data.display;\r\n    var pages = getCurrentPages()    \u002F\u002F获取加载的页面\r\n    var currentPage = pages[pages.length - 1]    \u002F\u002F获取当前页面的对象\r\n    var url = currentPage.route\r\n    var inUrl = url + \"?display=\" + encodeURI(str);\r\n    console.log(\"分享的链接为\"+inUrl);\r\n    return {\r\n      title: '您的好友给您分享了一段篆文',\r\n      path: inUrl,\r\n      success: function (res) {\r\n        \u002F\u002F 转发成功\r\n      },\r\n      fail: function (res) {\r\n        \u002F\u002F 转发失败\r\n      }\r\n    }\r\n  }\r\n}\r\n\u003C\u002Fscript\u003E\r\n\r\n\u003Cstyle lang=\"less\"\u003E\r\n.content{\r\n  text-align: center;\r\n}\r\ncanvas{\r\n  width: 256px;\r\n  height: 256px;\r\n}\r\n\r\n\u003C\u002Fstyle\u003E\r\n\r\n```\r\n\r\n## 后记\r\n\u003E 我这个实例本来是将svg转canvas绘制出来，再转图片，下载到本地的。但是因为draw()函数是异步的所以需要等待。才可以下载成功，否则会出现一片黑的情况，总之感觉各种麻烦。再加上画布的大小难以设置。后我还是选择在服务端生成图片再转发过来。\r\n\r\n## 参考文献\r\n1. [SVG简介](http:\u002F\u002Fwww.w3school.com.cn\u002Fsvg\u002Fsvg_intro.asp)\r\n2. [Touch WX开发文档](http:\u002F\u002Fwww.touchui.io\u002Ftouchui_doc_wx\u002F)\r\n3. [微信开发文档Canvas](https:\u002F\u002Fdevelopers.weixin.qq.com\u002Fminiprogram\u002Fdev\u002Fapi\u002Fcanvas\u002Fintro.html)",authorId:a,comments:a,views:2161,likes:1,tag:[{tid:4,name:"nodejs",order:a,count:a}],category:"学习笔记",category_id:11,fields:{}}},state:{error:null},_errors:{},serverRendered:true,config:{public:{TITLE:"指尖魔法屋-醉月思的博客",VERSION:"0.1.7 · build-20220516",KEYWORDS:["thinkmoon","指尖魔法屋","醉月思的博客"],DESCRIPTION:"web前端开发工程师、面向高保真编程、总结与记录是两个极其优秀的学习习惯、对知识和技术保持敬畏之心！",baseUrl:"https:\u002F\u002Fservice.thinkmoon.cn\u002Fapi"},app:{baseURL:"\u002F",buildAssetsDir:"\u002Fnuxt-asset\u002F",cdnURL:""}}}}(0))</script><script type="module" src="/nuxt-asset/entry-b3d792ef.mjs" crossorigin></script><script type="module" src="/nuxt-asset/default-97382c0d.mjs" crossorigin></script><script type="module" src="/nuxt-asset/_cid_-e1fa34ae.mjs" crossorigin></script>
</body>

</html>