<!DOCTYPE html>
<html  data-head-attrs="">

<head >
  <title>python3 + Django + uwsgi + nginx 配置部署笔记 | 指尖魔法屋-醉月思的博客</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><script async src="/ads.js" crossorigin="anonymous"></script><meta name="keywords" content="python"><meta name="description" content="web前端开发工程师、面向高保真编程、总结与记录是两个极其优秀的学习习惯、对知识和技术保持敬畏之心！"><meta name="head:count" content="5"><link rel="modulepreload" href="/_nuxt/entry-4033bfcf.mjs" as="script" crossorigin><link rel="preload" href="/_nuxt/entry.7e762317.css" as="style"><link rel="modulepreload" href="/_nuxt/default-ab4b1d95.mjs" as="script" crossorigin><link rel="preload" href="/_nuxt/default.8dc03fb7.css" as="style"><link rel="modulepreload" href="/_nuxt/Footer-39451558.mjs" as="script" crossorigin><link rel="modulepreload" href="/_nuxt/_cid_-40efc3b3.mjs" as="script" crossorigin><link rel="modulepreload" href="/_nuxt/asyncData-b0244fb3.mjs" as="script" crossorigin><link rel="prefetch" href="/_nuxt/background.36a7be78.jpg"><link rel="prefetch" as="script" href="/_nuxt/404-0c215052.mjs"><link rel="prefetch" as="script" href="/_nuxt/editor-3321b87d.mjs"><link rel="prefetch" as="script" href="/_nuxt/index-b882dfe7.mjs"><link rel="prefetch" as="script" href="/_nuxt/post-list-93b150a9.mjs"><link rel="prefetch" as="script" href="/_nuxt/admin-f89c7533.mjs"><link rel="prefetch" as="script" href="/_nuxt/_pageIndex_-08429fca.mjs"><link rel="prefetch" as="script" href="/_nuxt/PostList-693c3f84.mjs"><link rel="prefetch" as="script" href="/_nuxt/index-dbca3f00.mjs"><link rel="prefetch" as="script" href="/_nuxt/index-dc59a107.mjs"><link rel="prefetch" as="script" href="/_nuxt/login-d8f7e58b.mjs"><link rel="prefetch" as="script" href="/_nuxt/_pageIndex_-4617af3f.mjs"><link rel="prefetch" as="script" href="/_nuxt/_pageIndex_-38aaa266.mjs"><link rel="prefetch" as="script" href="/_nuxt/TagApi-b908df3a.mjs"><link rel="prefetch" as="script" href="/_nuxt/index-12cec95d.mjs"><link rel="prefetch" as="script" href="/_nuxt/auth-f948a8cb.mjs"><link rel="prefetch" as="script" href="/_nuxt/admin-1ee1b85d.mjs"><link rel="stylesheet" href="/_nuxt/entry.7e762317.css"><link rel="stylesheet" href="/_nuxt/default.8dc03fb7.css">
</head>

<body  data-head-attrs="">
  <div id="__nuxt"><!--[--><div><div class="top-menu" data-v-2d323d18><ul role="menubar" style="--el-menu-text-color:;--el-menu-hover-text-color:;--el-menu-bg-color:;--el-menu-hover-bg-color:;--el-menu-active-color:;" class="el-menu el-menu--horizontal" data-v-2d323d18><li class="el-menu-item" role="menuitem" tabindex="-1" style="" data-v-2d323d18><!--[--><!--[--> 指尖魔法屋 <!--]--><!--[--><!--]--><!--]--></li><li class="el-menu-item" role="menuitem" tabindex="-1" style="" data-v-2d323d18><!--[--><!--[--><a href="/category" class="" data-v-2d323d18> 分类 </a><!--]--><!--[--><!--]--><!--]--></li><li class="el-menu-item" role="menuitem" tabindex="-1" style="" data-v-2d323d18><!--[--><!--[--><a href="/tag" class="" data-v-2d323d18> 标签 </a><!--]--><!--[--><!--]--><!--]--></li></ul><div class="right" data-v-2d323d18><a class="el-link el-link--default" href="/login" data-v-2d323d18><!--v-if--><span class="el-link__inner"><!--[--><i class="el-icon pointer" style="font-size:26px;" data-v-2d323d18><!--[--><svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" data-v-2d323d18><path fill="currentColor" d="M512 512a192 192 0 1 0 0-384 192 192 0 0 0 0 384zm0 64a256 256 0 1 1 0-512 256 256 0 0 1 0 512zm320 320v-96a96 96 0 0 0-96-96H288a96 96 0 0 0-96 96v96a32 32 0 1 1-64 0v-96a160 160 0 0 1 160-160h448a160 160 0 0 1 160 160v96a32 32 0 1 1-64 0z"></path></svg><!--]--></i><!--]--></span><!--v-if--></a></div></div><div class="app-container"><!--[--><div class="app-container" data-v-14f20b86><!----><div class="article-content" data-v-14f20b86><div class="v-md-editor-preview" style="tab-size:2;" data-v-14f20b86><div class="github-markdown-body"><h1 data-v-md-heading="python3-django-uwsgi-nginx-配置部署笔记" data-v-md-line="1">python3 + Django + uwsgi + nginx 配置部署笔记</h1>
<blockquote data-v-md-line="2">
<p data-v-md-line="2">本文环境</p>
</blockquote>
<p data-v-md-line="4">操作系统: Ubuntu 16.04.3<br>
Python版本: 3.5.2<br>
Django版本: 2.0.4<br>
nginx版本: 1.10.3</p>
<blockquote data-v-md-line="9">
<p data-v-md-line="9">本文平台为腾讯云1核1G系统<br>
我的项目文件名为: <code>dgutpsy</code></p>
</blockquote>
<h2 data-v-md-heading="安装pip3-python3-的pip" data-v-md-line="12">安装pip3(python3 的pip)</h2>
<div data-v-md-line="13"><div class="v-md-pre-wrapper v-md-pre-wrapper-shell extra-class"><pre class="v-md-hljs-shell"><code>sudo apt-get install python3-pip
</code></pre>
</div></div><p data-v-md-line="16"><img src="https://segmentfault.com/img/bV8qdQ" alt="2018-04-10-20-07-25.png"></p>
<blockquote data-v-md-line="18">
<p data-v-md-line="18">安装成功后运行<code>pip3</code>将会出现</p>
</blockquote>
<p data-v-md-line="20"><img src="https://segmentfault.com/img/bV8qdO" alt="2018-04-10-20-09-19.png"></p>
<h2 data-v-md-heading="安装uwsgi" data-v-md-line="22">安装uwsgi</h2>
<div data-v-md-line="23"><div class="v-md-pre-wrapper v-md-pre-wrapper-shell extra-class"><pre class="v-md-hljs-shell"><code>pip install uwsgi
</code></pre>
</div></div><p data-v-md-line="26"><img src="https://segmentfault.com/img/bV8qdN" alt="2018-04-10-20-17-19.png"></p>
<h2 data-v-md-heading="测试uwsgi运行状态" data-v-md-line="28">测试uwsgi运行状态</h2>
<blockquote data-v-md-line="29">
<p data-v-md-line="29">新建文件test.py</p>
</blockquote>
<div data-v-md-line="30"><div class="v-md-pre-wrapper v-md-pre-wrapper-python extra-class"><pre class="v-md-hljs-python"><code><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">application</span>(<span class="hljs-params">env, start_response</span>):</span>
    start_response(<span class="hljs-string">&#x27;200 OK&#x27;</span>, [(<span class="hljs-string">&#x27;Content-Type&#x27;</span>,<span class="hljs-string">&#x27;text/html&#x27;</span>)])
    <span class="hljs-keyword">return</span> [<span class="hljs-string">b&quot;Hello World&quot;</span>]
</code></pre>
</div></div><blockquote data-v-md-line="35">
<p data-v-md-line="35">有些教程说是 <code>return &quot;hello world&quot;</code><br>
但是这样其实会出现访问空白的情况, 我的是Python3的环境，需要对hello world进行编码.<br>
而如果你是Python2的环境，你应该写<code>return &quot;hello world&quot;</code></p>
</blockquote>
<h3 data-v-md-heading="使用uwsgi运行该文件" data-v-md-line="40">使用uwsgi运行该文件</h3>
<div data-v-md-line="41"><div class="v-md-pre-wrapper v-md-pre-wrapper-shell extra-class"><pre class="v-md-hljs-shell"><code>uwsgi --http :8000 --wsgi-file test.py
</code></pre>
</div></div><blockquote data-v-md-line="44">
<p data-v-md-line="44">此语句的意思是，<code>使用uwsgi运行test.py文件， 采用http模式， 端口8000</code></p>
</blockquote>
<p data-v-md-line="46"><img src="https://segmentfault.com/img/bV8qdP" alt="2018-04-10-20-44-49.png"></p>
<h3 data-v-md-heading="访问页面" data-v-md-line="48">访问页面</h3>
<blockquote data-v-md-line="50">
<p data-v-md-line="50">好啦,可以看到亲切的hello world 就说明uwsgi运行成功了</p>
</blockquote>
<p data-v-md-line="52"><img src="https://segmentfault.com/img/bV8qdL" alt="2018-04-10-20-39-21.png"></p>
<blockquote data-v-md-line="54">
<p data-v-md-line="54">TIPS: 如果你访问不了,请先检查腾讯云安全组端口是否开放8000端口</p>
</blockquote>
<h2 data-v-md-heading="安装django" data-v-md-line="55">安装Django</h2>
<div data-v-md-line="56"><div class="v-md-pre-wrapper v-md-pre-wrapper-shell extra-class"><pre class="v-md-hljs-shell"><code>pip3 install Django
</code></pre>
</div></div><blockquote data-v-md-line="59">
<p data-v-md-line="59">如在python3里面import django没有报错则安装成功.</p>
</blockquote>
<p data-v-md-line="61"><img src="https://segmentfault.com/img/bV8qdH" alt="2018-04-10-20-55-49.png"></p>
<h2 data-v-md-heading="上传项目代码" data-v-md-line="63">上传项目代码</h2>
<blockquote data-v-md-line="64">
<p data-v-md-line="64">现在我们开始上传项目代码</p>
</blockquote>
<p data-v-md-line="66"><img src="https://segmentfault.com/img/bV8qdG" alt="2018-04-10-20-42-25.png"></p>
<blockquote data-v-md-line="68">
<p data-v-md-line="68">使用MobaXterm的sftp工具拖进来,[笑着哭]不要问我为什么不用ftp,这个方便.</p>
</blockquote>
<h2 data-v-md-heading="确认代码运行正常" data-v-md-line="69">确认代码运行正常</h2>
<blockquote data-v-md-line="70">
<p data-v-md-line="70">切进项目目录,运行</p>
</blockquote>
<div data-v-md-line="71"><div class="v-md-pre-wrapper v-md-pre-wrapper-shell extra-class"><pre class="v-md-hljs-shell"><code>python3 manage.py runserver 0.0.0.0:8000
</code></pre>
</div></div><p data-v-md-line="74"><img src="https://segmentfault.com/img/bV8qdF" alt="2018-04-10-20-59-03.png"></p>
<h3 data-v-md-heading="访问页面-1" data-v-md-line="75">访问页面</h3>
<p data-v-md-line="76"><img src="https://segmentfault.com/img/bV8qdE" alt="2018-04-10-21-01-32.png"></p>
<blockquote data-v-md-line="77">
<p data-v-md-line="77">不太对?这是因为设置了ALLOWED_HOSTS的原因<br>
我们在setting.py里设置一下</p>
</blockquote>
<div data-v-md-line="79"><div class="v-md-pre-wrapper v-md-pre-wrapper-python extra-class"><pre class="v-md-hljs-python"><code>ALLOWED_HOSTS = [<span class="hljs-string">&#x27;*&#x27;</span>]
</code></pre>
</div></div><h3 data-v-md-heading="再次访问页面" data-v-md-line="82">再次访问页面</h3>
<p data-v-md-line="83"><img src="https://segmentfault.com/img/bV8qdK" alt="2018-04-10-21-05-34.png"></p>
<blockquote data-v-md-line="84">
<p data-v-md-line="84">OK!</p>
</blockquote>
<h2 data-v-md-heading="uswgi运行项目" data-v-md-line="86">uswgi运行项目</h2>
<div data-v-md-line="87"><div class="v-md-pre-wrapper v-md-pre-wrapper-shell extra-class"><pre class="v-md-hljs-shell"><code> uwsgi --http :8000 --chdir /home/ubuntu/dgutpsy  --wsgi dgutpsy.wsgi
</code></pre>
</div></div><blockquote data-v-md-line="90">
<p data-v-md-line="90">这个语句的意思与上相似，只不过是多了一个工作路径和wsgi文件<br>
<img src="https://segmentfault.com/img/bV8qdK" alt="2018-04-10-21-05-34.png"><br>
开什么玩笑? 你觉得没变化?</p>
</blockquote>
<hr data-v-md-line="94">
<h2 data-v-md-heading="至此" data-v-md-line="95"><em>至此</em></h2>
<blockquote data-v-md-line="96">
<p data-v-md-line="96">我们可以暂定以下内容</p>
</blockquote>
<ol data-v-md-line="97">
<li>项目没问题.</li>
<li>项目配置没问题</li>
<li>uwsgi没问题</li>
<li>对项目的支持环境没问题</li>
</ol>
<hr data-v-md-line="101">
<blockquote data-v-md-line="103">
<p data-v-md-line="103">接下来, 我们开始配置nginx</p>
</blockquote>
<h2 data-v-md-heading="安装nginx" data-v-md-line="105">安装nginx</h2>
<div data-v-md-line="106"><div class="v-md-pre-wrapper v-md-pre-wrapper-shell extra-class"><pre class="v-md-hljs-shell"><code>sudo apt-get install nginx
</code></pre>
</div></div><h2 data-v-md-heading="测试nginx运行状态" data-v-md-line="110">测试nginx运行状态</h2>
<p data-v-md-line="111"><img src="https://segmentfault.com/img/bV8qdD" alt="2018-04-10-21-18-53.png"></p>
<blockquote data-v-md-line="112">
<p data-v-md-line="112">nginx 安装成功</p>
</blockquote>
<h2 data-v-md-heading="修改nginx配置" data-v-md-line="114">修改nginx配置</h2>
<blockquote data-v-md-line="115">
<p data-v-md-line="115">文件路径<code>&quot;/etc/nginx/sites-enabled/default&quot;</code></p>
</blockquote>
<p data-v-md-line="117">别再费力找nginx.conf啦,新版本已经没有这个文件的.</p>
<blockquote data-v-md-line="118">
<p data-v-md-line="118">我的</p>
</blockquote>
<div data-v-md-line="119"><div class="v-md-pre-wrapper v-md-pre-wrapper-conf extra-class"><pre class="v-md-hljs-conf"><code>upstream django {
        server 127.0.0.1:8001; #web的socket端口
    }
server {
	listen 80 default_server;
	listen [::]:80 default_server;
 
	index index.html index.htm index.nginx-debian.html;

	server_name _;

	location / {
		root /home/ubuntu/dgutpsy; #项目目录
        uwsgi_pass django;
        include /home/ubuntu/dgutpsy/uwsgi_params; #uwsgi_params文件的地址
	}
}
</code></pre>
</div></div><p data-v-md-line="138">完整的uwsgi_params文件内容应该是</p>
<div data-v-md-line="139"><div class="v-md-pre-wrapper v-md-pre-wrapper-python extra-class"><pre class="v-md-hljs-python"><code>uwsgi_param  QUERY_STRING       $query_string;
uwsgi_param  REQUEST_METHOD     $request_method;
uwsgi_param  CONTENT_TYPE       $content_type;
uwsgi_param  CONTENT_LENGTH     $content_length;

uwsgi_param  REQUEST_URI        $request_uri;
uwsgi_param  PATH_INFO          $document_uri;
uwsgi_param  DOCUMENT_ROOT      $document_root;
uwsgi_param  SERVER_PROTOCOL    $server_protocol;
uwsgi_param  REQUEST_SCHEME     $scheme;
uwsgi_param  HTTPS              $https if_not_empty;

uwsgi_param  REMOTE_ADDR        $remote_addr;
uwsgi_param  REMOTE_PORT        $remote_port;
uwsgi_param  SERVER_PORT        $server_port;
uwsgi_param  SERVER_NAME        $server_name;
</code></pre>
</div></div><blockquote data-v-md-line="157">
<p data-v-md-line="157">没有这个文件,或者这个文件写错是会报错的哦.</p>
</blockquote>
<h2 data-v-md-heading="访问测试502" data-v-md-line="158">访问测试502</h2>
<p data-v-md-line="159"><img src="https://segmentfault.com/img/bV8qdC" alt="2018-04-10-21-37-49.png"></p>
<blockquote data-v-md-line="160">
<p data-v-md-line="160">这是因为我们的socket通信还没开始呢!</p>
</blockquote>
<h2 data-v-md-heading="nginx-与-uwsgi通信" data-v-md-line="161">nginx 与 uwsgi通信</h2>
<blockquote data-v-md-line="162">
<p data-v-md-line="162">先使用hello world测试</p>
</blockquote>
<div data-v-md-line="163"><div class="v-md-pre-wrapper v-md-pre-wrapper-shell extra-class"><pre class="v-md-hljs-shell"><code>uwsgi --socket :8001 --wsgi-file test.py
</code></pre>
</div></div><h3 data-v-md-heading="访问测试页面" data-v-md-line="166">访问测试页面</h3>
<p data-v-md-line="167"><img src="https://segmentfault.com/img/bVbi2Qy" alt="图片描述"></p>
<hr data-v-md-line="168">
<p data-v-md-line="169">至此: nginx 与 uwsgi通信成功!</p>
<blockquote data-v-md-line="170">
<p data-v-md-line="170">TIPS: 这里你是无法通过在浏览器里面访问8001端口来判断是否启动的，因为它是socket协议</p>
</blockquote>
<hr data-v-md-line="171">
<h2 data-v-md-heading="让uwsgi后台运行" data-v-md-line="172">让uwsgi后台运行</h2>
<blockquote data-v-md-line="173">
<p data-v-md-line="173">这样虽然看似可以, 但是当你关闭ssh时,又会出现502了!</p>
<p data-v-md-line="175">这是因为当你关闭这个ssh进程时,uwsgi进程也被终止了.<br>
而且,每次启动都要输一串好长的命令,好不麻烦!</p>
</blockquote>
<p data-v-md-line="178">这个时候,我们需要用到一个东西, 那就是ini配置文件启动.<br>
其中<code>daemonize = /home/ubuntu/dgutpsy/test.log</code>的意思就是后台运行并规定日志输出目录。</p>
<h3 data-v-md-heading="新建test-ini" data-v-md-line="180">新建test.ini</h3>
<div data-v-md-line="181"><div class="v-md-pre-wrapper v-md-pre-wrapper-ini extra-class"><pre class="v-md-hljs-ini"><code><span class="hljs-section">[uwsgi]</span>
<span class="hljs-attr">socket</span> = <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8001</span>
<span class="hljs-attr">wsgi-file</span> = /home/ubuntu/dgutpsy/test.py
<span class="hljs-attr">daemonize</span> = /home/ubuntu/dgutpsy/test.log 
</code></pre>
</div></div><div data-v-md-line="187"><div class="v-md-pre-wrapper v-md-pre-wrapper-shell extra-class"><pre class="v-md-hljs-shell"><code>uwsgi --ini test.ini
</code></pre>
</div></div><h2 data-v-md-heading="niginx与django项目通信" data-v-md-line="190">niginx与Django项目通信</h2>
<h3 data-v-md-heading="新建dgutpsy-ini" data-v-md-line="191">新建dgutpsy.ini</h3>
<div data-v-md-line="192"><div class="v-md-pre-wrapper v-md-pre-wrapper- extra-class"><pre class="v-md-hljs-"><code>[uwsgi]
socket = 127.0.0.1:8001
chdir           = /home/ubuntu/dgutpsy
module          = dgutpsy.wsgi
master          = true
processes       = 1 

threads = 2 
max-requests = 6000

daemonize = /home/ubuntu/dgutpsy/run.log

</code></pre>
</div></div><p data-v-md-line="206">然后运行</p>
<div data-v-md-line="207"><div class="v-md-pre-wrapper v-md-pre-wrapper-shell extra-class"><pre class="v-md-hljs-shell"><code>uwsgi --ini dgutpsy.ini
</code></pre>
</div></div><h2 data-v-md-heading="域名映射" data-v-md-line="210">域名映射</h2>
<p data-v-md-line="212">添加域名&gt;解析<code>consult.psyannabel.cn</code></p>
<h3 data-v-md-heading="访问页面-2" data-v-md-line="213">访问页面</h3>
<p data-v-md-line="214"><img src="https://blog.cdn.thinkmoon.cn/2018-04-10-22-17-32.png" alt></p>
<h2 data-v-md-heading="后记" data-v-md-line="216">后记:</h2>
<blockquote data-v-md-line="218">
<p data-v-md-line="218">Q&amp;A:<br>
Q: 能用manage.py运行的,为什么要用uwsgi?</p>
<blockquote data-v-md-line="220">
<p data-v-md-line="220">A: 单进程的manage.py, 能和web服务器uwsgi比ma</p>
</blockquote>
<p data-v-md-line="222">Q: 能用uwsgi的,为什么还要用nginx?</p>
<blockquote data-v-md-line="223">
<p data-v-md-line="223">A: uwsgi虽然是web服务器, 但是它在处理静态文件时, 并没有nginx来得优秀.</p>
</blockquote>
<p data-v-md-line="225">Q: 大致流程?</p>
<blockquote data-v-md-line="226">
<p data-v-md-line="226">A: nginx运行web处理http请求, nginx使用socket与uwsgi通信,将动态部分转让交给uwsgi处理</p>
</blockquote>
<p data-v-md-line="228">Q: 为啥我的test.py运行不了？</p>
<blockquote data-v-md-line="229">
<p data-v-md-line="229">A: 如果端口开放没有问题，那么请检查Python版本对应的return</p>
</blockquote>
</blockquote>
<blockquote data-v-md-line="246">
<p data-v-md-line="246">版权声明: 本文首发于<a href="https://www.thinkmoon.cn/post/11" class="custom-internal-link" target="_blank">指尖魔法屋-python3 + Django + uwsgi + nginx 配置部署笔记</a>,转载或引用必须申明原指尖魔法屋来源及源地址！</p>
</blockquote>
</div></div></div></div><!--]--></div><span></span></div><div class="footer" data-v-68ae0dac><span data-v-68ae0dac>Copyright © 2017-2022 指尖魔法屋. All rights reserved</span><span data-v-68ae0dac>POWERED BY thinkBlog · v0.1.5 · build-20220508-0211</span><span data-v-68ae0dac>网站持续搭建中，感谢关注</span><span data-v-68ae0dac>本站已顽强运行：蛮久了~</span><div data-v-68ae0dac><a class="el-link el-link--primary is-underline" href="http://beian.miit.gov.cn/" data-v-68ae0dac><!--v-if--><span class="el-link__inner"><!--[--> 粤ICP备17055617号 <!--]--></span><!--v-if--></a></div></div><!--]--></div><script>window.__NUXT__=(function(a,b){return {data:{pinia:{},article:{cid:b,title:"python3 + Django + uwsgi + nginx 配置部署笔记",created:1542335880,modified:1547608436,text:"\u003E 本文环境\r\n\r\n操作系统: Ubuntu 16.04.3\r\nPython版本: 3.5.2\r\nDjango版本: 2.0.4\r\nnginx版本: 1.10.3\r\n\r\n\u003E本文平台为腾讯云1核1G系统 \r\n\u003E 我的项目文件名为: `dgutpsy`\r\n\r\n## 安装pip3(python3 的pip)\r\n```shell\r\nsudo apt-get install python3-pip\r\n```\r\n![2018-04-10-20-07-25.png][1]\r\n\r\n\u003E 安装成功后运行`pip3`将会出现\r\n\r\n![2018-04-10-20-09-19.png][2]\r\n\r\n## 安装uwsgi\r\n```shell\r\npip install uwsgi\r\n```\r\n![2018-04-10-20-17-19.png][3]\r\n\r\n## 测试uwsgi运行状态\r\n\u003E 新建文件test.py\r\n```python\r\ndef application(env, start_response):\r\n    start_response('200 OK', [('Content-Type','text\u002Fhtml')])\r\n    return [b\"Hello World\"]\r\n```\r\n\u003E 有些教程说是 `return \"hello world\"`\r\n\u003E 但是这样其实会出现访问空白的情况, 我的是Python3的环境，需要对hello world进行编码.\r\n而如果你是Python2的环境，你应该写`return \"hello world\"`\r\n\r\n\r\n### 使用uwsgi运行该文件\r\n```shell\r\nuwsgi --http :8000 --wsgi-file test.py\r\n```\r\n\u003E 此语句的意思是，`使用uwsgi运行test.py文件， 采用http模式， 端口8000`\r\n\r\n![2018-04-10-20-44-49.png][4]\r\n\r\n### 访问页面\r\n\r\n\u003E 好啦,可以看到亲切的hello world 就说明uwsgi运行成功了\r\n\r\n![2018-04-10-20-39-21.png][5]\r\n\r\n\u003E TIPS: 如果你访问不了,请先检查腾讯云安全组端口是否开放8000端口\r\n## 安装Django\r\n```shell\r\npip3 install Django\r\n```\r\n\u003E 如在python3里面import django没有报错则安装成功.\r\n\r\n![2018-04-10-20-55-49.png][6]\r\n\r\n## 上传项目代码\r\n\u003E 现在我们开始上传项目代码\r\n\r\n![2018-04-10-20-42-25.png][7]\r\n\r\n\u003E 使用MobaXterm的sftp工具拖进来,[笑着哭]不要问我为什么不用ftp,这个方便.\r\n## 确认代码运行正常\r\n\u003E 切进项目目录,运行\r\n```shell\r\npython3 manage.py runserver 0.0.0.0:8000\r\n```\r\n![2018-04-10-20-59-03.png][8]\r\n### 访问页面\r\n![2018-04-10-21-01-32.png][9]\r\n\u003E 不太对?这是因为设置了ALLOWED_HOSTS的原因\r\n\u003E 我们在setting.py里设置一下\r\n```python\r\nALLOWED_HOSTS = ['*']\r\n```\r\n### 再次访问页面\r\n![2018-04-10-21-05-34.png][10]\r\n\u003E OK!\r\n\r\n## uswgi运行项目\r\n```shell\r\n uwsgi --http :8000 --chdir \u002Fhome\u002Fubuntu\u002Fdgutpsy  --wsgi dgutpsy.wsgi\r\n```\r\n\u003E 这个语句的意思与上相似，只不过是多了一个工作路径和wsgi文件\r\n![2018-04-10-21-05-34.png][11]\r\n\u003E 开什么玩笑? 你觉得没变化?\r\n\r\n***\r\n## *至此*\r\n\u003E 我们可以暂定以下内容\r\n1. 项目没问题. \r\n2. 项目配置没问题\r\n3. uwsgi没问题\r\n4. 对项目的支持环境没问题\r\n***\r\n\r\n\u003E 接下来, 我们开始配置nginx\r\n\r\n## 安装nginx\r\n```shell\r\nsudo apt-get install nginx\r\n```\r\n\r\n## 测试nginx运行状态\r\n![2018-04-10-21-18-53.png][12]\r\n\u003E nginx 安装成功\r\n\r\n## 修改nginx配置\r\n\u003E 文件路径`\"\u002Fetc\u002Fnginx\u002Fsites-enabled\u002Fdefault\"`\r\n\r\n别再费力找nginx.conf啦,新版本已经没有这个文件的.\r\n\u003E 我的\r\n```conf\r\nupstream django {\r\n        server 127.0.0.1:8001; #web的socket端口\r\n    }\r\nserver {\r\n\tlisten 80 default_server;\r\n\tlisten [::]:80 default_server;\r\n \r\n\tindex index.html index.htm index.nginx-debian.html;\r\n\r\n\tserver_name _;\r\n\r\n\tlocation \u002F {\r\n\t\troot \u002Fhome\u002Fubuntu\u002Fdgutpsy; #项目目录\r\n        uwsgi_pass django;\r\n        include \u002Fhome\u002Fubuntu\u002Fdgutpsy\u002Fuwsgi_params; #uwsgi_params文件的地址\r\n\t}\r\n}\r\n```\r\n完整的uwsgi_params文件内容应该是\r\n```python\r\nuwsgi_param  QUERY_STRING       $query_string;\r\nuwsgi_param  REQUEST_METHOD     $request_method;\r\nuwsgi_param  CONTENT_TYPE       $content_type;\r\nuwsgi_param  CONTENT_LENGTH     $content_length;\r\n\r\nuwsgi_param  REQUEST_URI        $request_uri;\r\nuwsgi_param  PATH_INFO          $document_uri;\r\nuwsgi_param  DOCUMENT_ROOT      $document_root;\r\nuwsgi_param  SERVER_PROTOCOL    $server_protocol;\r\nuwsgi_param  REQUEST_SCHEME     $scheme;\r\nuwsgi_param  HTTPS              $https if_not_empty;\r\n\r\nuwsgi_param  REMOTE_ADDR        $remote_addr;\r\nuwsgi_param  REMOTE_PORT        $remote_port;\r\nuwsgi_param  SERVER_PORT        $server_port;\r\nuwsgi_param  SERVER_NAME        $server_name;\r\n```\r\n\u003E 没有这个文件,或者这个文件写错是会报错的哦.\r\n## 访问测试502\r\n![2018-04-10-21-37-49.png][13]\r\n\u003E 这是因为我们的socket通信还没开始呢!\r\n## nginx 与 uwsgi通信\r\n\u003E 先使用hello world测试\r\n```shell\r\nuwsgi --socket :8001 --wsgi-file test.py\r\n```\r\n### 访问测试页面\r\n![图片描述][14]\r\n*** \r\n至此: nginx 与 uwsgi通信成功!\r\n\u003E TIPS: 这里你是无法通过在浏览器里面访问8001端口来判断是否启动的，因为它是socket协议\r\n***\r\n## 让uwsgi后台运行\r\n\u003E 这样虽然看似可以, 但是当你关闭ssh时,又会出现502了!\r\n\u003E\r\n\u003E 这是因为当你关闭这个ssh进程时,uwsgi进程也被终止了.\r\n而且,每次启动都要输一串好长的命令,好不麻烦!\r\n\r\n这个时候,我们需要用到一个东西, 那就是ini配置文件启动.\r\n其中`daemonize = \u002Fhome\u002Fubuntu\u002Fdgutpsy\u002Ftest.log`的意思就是后台运行并规定日志输出目录。\r\n### 新建test.ini\r\n```ini\r\n[uwsgi]\r\nsocket = 127.0.0.1:8001\r\nwsgi-file = \u002Fhome\u002Fubuntu\u002Fdgutpsy\u002Ftest.py\r\ndaemonize = \u002Fhome\u002Fubuntu\u002Fdgutpsy\u002Ftest.log \r\n```\r\n```shell\r\nuwsgi --ini test.ini\r\n```\r\n## niginx与Django项目通信\r\n### 新建dgutpsy.ini\r\n```\r\n[uwsgi]\r\nsocket = 127.0.0.1:8001\r\nchdir           = \u002Fhome\u002Fubuntu\u002Fdgutpsy\r\nmodule          = dgutpsy.wsgi\r\nmaster          = true\r\nprocesses       = 1 \r\n\r\nthreads = 2 \r\nmax-requests = 6000\r\n\r\ndaemonize = \u002Fhome\u002Fubuntu\u002Fdgutpsy\u002Frun.log\r\n\r\n```\r\n然后运行\r\n```shell\r\nuwsgi --ini dgutpsy.ini\r\n```\r\n## 域名映射\r\n\r\n添加域名\u003E解析`consult.psyannabel.cn`\r\n### 访问页面\r\n![](https:\u002F\u002Fblog.cdn.thinkmoon.cn\u002F2018-04-10-22-17-32.png)\r\n\r\n## 后记:\r\n\r\n\u003E Q&A:\r\n\u003E Q: 能用manage.py运行的,为什么要用uwsgi?\r\n\u003E \u003E A: 单进程的manage.py, 能和web服务器uwsgi比ma\r\n\u003E\r\n\u003E Q: 能用uwsgi的,为什么还要用nginx?\r\n\u003E \u003E A: uwsgi虽然是web服务器, 但是它在处理静态文件时, 并没有nginx来得优秀.\r\n\u003E\r\n\u003E Q: 大致流程?\r\n\u003E \u003E A: nginx运行web处理http请求, nginx使用socket与uwsgi通信,将动态部分转让交给uwsgi处理\r\n\u003E \r\n\u003E Q: 为啥我的test.py运行不了？\r\n\u003E \u003E A: 如果端口开放没有问题，那么请检查Python版本对应的return\r\n\r\n\r\n  [1]: https:\u002F\u002Fsegmentfault.com\u002Fimg\u002FbV8qdQ\r\n  [2]: https:\u002F\u002Fsegmentfault.com\u002Fimg\u002FbV8qdO\r\n  [3]: https:\u002F\u002Fsegmentfault.com\u002Fimg\u002FbV8qdN\r\n  [4]: https:\u002F\u002Fsegmentfault.com\u002Fimg\u002FbV8qdP\r\n  [5]: https:\u002F\u002Fsegmentfault.com\u002Fimg\u002FbV8qdL\r\n  [6]: https:\u002F\u002Fsegmentfault.com\u002Fimg\u002FbV8qdH\r\n  [7]: https:\u002F\u002Fsegmentfault.com\u002Fimg\u002FbV8qdG\r\n  [8]: https:\u002F\u002Fsegmentfault.com\u002Fimg\u002FbV8qdF\r\n  [9]: https:\u002F\u002Fsegmentfault.com\u002Fimg\u002FbV8qdE\r\n  [10]: https:\u002F\u002Fsegmentfault.com\u002Fimg\u002FbV8qdK\r\n  [11]: https:\u002F\u002Fsegmentfault.com\u002Fimg\u002FbV8qdK\r\n  [12]: https:\u002F\u002Fsegmentfault.com\u002Fimg\u002FbV8qdD\r\n  [13]: https:\u002F\u002Fsegmentfault.com\u002Fimg\u002FbV8qdC\r\n  [14]: https:\u002F\u002Fsegmentfault.com\u002Fimg\u002FbVbi2Qy",authorId:a,comments:a,views:2566,likes:1,tag:[{tid:6,name:"python",order:a,count:a}],category:"学习笔记",category_id:b,fields:{thumb:"https:\u002F\u002Fblog.cdn.thinkmoon.cn\u002F2018-04-10-20-07-25.png"}}},state:{error:null},_errors:{},serverRendered:true,config:{public:{TITLE:"指尖魔法屋-醉月思的博客",VERSION:"0.1.5 · build-20220508-0211",KEYWORDS:["thinkmoon","指尖魔法屋","醉月思的博客"],DESCRIPTION:"web前端开发工程师、面向高保真编程、总结与记录是两个极其优秀的学习习惯、对知识和技术保持敬畏之心！",baseUrl:"https:\u002F\u002Fservice.thinkmoon.cn\u002Fapi"},app:{baseURL:"\u002F",buildAssetsDir:"\u002F_nuxt\u002F",cdnURL:""}}}}(0,11))</script><script type="module" src="/_nuxt/entry-4033bfcf.mjs" crossorigin></script><script type="module" src="/_nuxt/default-ab4b1d95.mjs" crossorigin></script><script type="module" src="/_nuxt/_cid_-40efc3b3.mjs" crossorigin></script>
</body>

</html>